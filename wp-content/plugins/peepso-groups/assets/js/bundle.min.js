!function e(t,o,r){function i(s,a){if(!o[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(n)return n(s,!0);throw(u=new Error("Cannot find module '"+s+"'")).code="MODULE_NOT_FOUND",u}u=o[s]={exports:{}},t[s][0].call(u.exports,function(e){return i(t[s][1][e]||e)},u,u.exports,e,t,o,r)}return o[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,o){(function(e){(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var r,i=(r="undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null)&&r.__esModule?r:{default:r},n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var o=function(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return e}();if(o&&o.has(e))return o.get(e);var r,i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var s;Object.prototype.hasOwnProperty.call(e,r)&&((s=n?Object.getOwnPropertyDescriptor(e,r):null)&&(s.get||s.set)?Object.defineProperty(i,r,s):i[r]=e[r])}return i.default=e,o&&o.set(e,i),i}("undefined"!=typeof window?window.peepso:void 0!==e?e.peepso:null);function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=peepsogroupsdata.listItemMemberActionsTemplate,u=function(){function e(t){var o=this;!function(t,o){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.id=t.id,this.actions=this.constructor.normalize(t),this.template=(0,n.template)(a),this.$el=(0,i.default)("<div />"),this.$el.on("click","[data-method]",function(e){o.onClick(e)}),this.render()}var t,o,r;return t=e,r=[{key:"normalize",value:function(e){var t,o,r;function i(e,t){return _.map(e,function(e){return _.isString(e.action)&&e.action.indexOf(".")<0?e.action=t+"."+e.action:_.isArray(e.action)&&(e.action=i(e.action,t)),e})}return(t=(e=e||{}).group||{}).groupuserajax&&void 0!==t.groupuserajax.member_actions?o=i(t.groupuserajax.member_actions||[],"groupuserajax"):void 0!==e.member_actions&&(o=i(e.member_actions||[],"groupuserajax")),t.groupfollowerajax&&void 0!==t.groupfollowerajax.follower_actions?r=i(t.groupfollowerajax.follower_actions||[],"groupfollowerajax"):void 0!==e.follower_actions&&(r=i(e.follower_actions||[],"groupfollowerajax")),{member_actions:o,follower_actions:r}}}],(o=[{key:"render",value:function(){var e=this.template(_.extend({id:this.id},this.actions));this.$el.html(e)}},{key:"fetch",value:function(){var e=this;return new Promise(function(t,o){var r={group_id:e.id,keys:"groupuserajax.member_actions,groupfollowerajax.follower_actions"};n.default.postJson("groupajax.group",r,function(e){e.success?t(e.data):o(e.errors)})})}},{key:"confirmAction",value:function(e){return new Promise(function(t,o){e?pswindow.confirm(e,function(){pswindow.hide(),t()},function(){o()}):t()})}},{key:"doAction",value:function(e,t){var o=this;return new Promise(function(r,i){n.default.postJson(e,t,function(t){var n;t.success?e.match(/\.(join|leave)$/)?(n=t.data.member_count,o.fetch().then(function(e){_.extend(e,{member_count:n}),r(e)}).catch(function(e){i(e)})):r(t.data):i(t.errors)})})}},{key:"onClick",value:function(e){var t=this;e.preventDefault(),e.stopPropagation();var o,r,s,a=(0,i.default)(e.currentTarget);a.data("ps-loading")||(o=i.default.extend({},a.data())).method&&o.id&&(!(r=a.find("img")).length&&a.parent().hasClass("ps-js-dropdown-menu")&&(r=(r=a.parent().siblings(".ps-js-dropdown-toggle")).find("img"),a.parent().hide()),s=o.method,e=o.confirm,o.group_id=o.id,delete o.method,delete o.confirm,delete o.id,this.confirmAction(e).then(function(){a.data("ps-loading",!0),r.show(),t.doAction(s,o).then(function(e){var o=t.constructor.normalize(e);t.actions=_.defaults({},o,t.actions),t.render(),e.member_count&&n.observer.applyFilters("group_update_member_count",t.id,e.member_count)})}).catch(i.default.noop))}}])&&s(t.prototype,o),r&&s(t,r),e}();o.default=u}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,o){"use strict";var r,i,n,s=e("./group-actions").default;function a(){n.observer.addFilter("group_update_member_count",function(e,t){var o=i(".ps-js-group-item--"+e).find(".ps-js-member-count");o.length&&(e=1<+t?peepsogroupsdata.lang.members:peepsogroupsdata.lang.member,o.html(t+" "+e))},10,2),i(document.body).on("click",".ps-js-groups .ps-js-member-action",i.proxy(function(e){var t,o,r,s=i(e.currentTarget);e.preventDefault(),e.stopPropagation(),s.data("ps-loading")||(o=i.extend({},s.data())).method&&o.id&&(!(t=s.find("img")).length&&s.parent().hasClass("ps-js-dropdown-menu")&&(t=(t=s.parent().siblings(".ps-js-dropdown-toggle")).find("img"),s.parent().hide()),r=o.method,e=o.confirm,o.group_id=o.id,delete o.method,delete o.confirm,delete o.id,this._member_action_confirmation(e).done(function(){s.data("ps-loading",!0),t.show(),this.member_action(r,o).done(function(e){var t=s.closest(".ps-js-member-actions"),r=n.template(peepsogroupsdata.listItemMemberActionsTemplate)(i.extend({id:o.group_id},e));t.html(r),e.member_count&&n.observer.applyFilters("group_update_member_count",o.group_id,e.member_count)})}))},this)),i(document.body).on("click",".ps-js-groups .ps-js-more",i.proxy(function(e){var t=".ps-js-group-item",o="ps-group--expanded",r=i(e.currentTarget).closest(t);e.preventDefault(),e.stopPropagation(),i(".ps-groups").find(t).each(function(){var e=i(this);e.is(r)&&!e.hasClass(o)?(e.addClass(o),e.find(".ps-js-more span").html(peepsogroupsdata.lang.less)):e.hasClass(o)&&(e.removeClass(o),e.find(".ps-js-more span").html(peepsogroupsdata.lang.more))})},this))}r=jQuery,e=peepso,window.ps_groups=(i=r,n=e,a.prototype._fetch=function(e){return i.Deferred(i.proxy(function(t){var o=(e.category||0)+"";this._fetch_xhr=this._fetch_xhr||{},this._fetch_xhr[o]&&this._fetch_xhr[o].abort(),this._fetch_xhr[o]=n.disableAuth().getJson("groupsajax.search",e,i.proxy(function(o){var r,a,u,c,l,p=n.template(peepsogroupsdata.listItemTemplate),d=(n.template(peepsogroupsdata.listItemMemberActionsTemplate),o.data||{}),f="";if(d.groups&&d.groups.length){for(l=0;l<d.groups.length;l++)(r=d.groups[l]).nameHighlight=r.name||"",c=r.description.match("peepso-markdown"),r.description=c?n.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+r.description+"</div>"):i("<div/>").html(r.description||"").text(),e.query&&(a=e.query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),a=RegExp("("+a+")","ig"),u='<span style="background:'+n.getLinkColor(.3)+'">$1</span>',r.nameHighlight=r.nameHighlight.replace(a,u),c||(r.description=(r.description||"").replace(a,u))),f+=p(i.extend({},r,{member_actions:""})),_.defer(function(e){var t=i(".ps-js-group-item--"+e.id).find(".ps-js-member-actions");e=new s({id:e.id,member_actions:e.groupuserajax.member_actions,follower_actions:e.groupfollowerajax.follower_actions}),t.html(e.$el)},r);t.resolveWith(this,[f])}else 1<e.page?t.resolveWith(this,[null]):t.rejectWith(this,[o.errors])},this))},this))},a.prototype._member_action_confirmation=function(e){return i.Deferred(i.proxy(function(t){e?pswindow.confirm(e,i.proxy(function(){pswindow.hide(),t.resolveWith(this)},this),i.proxy(function(){t.rejectWith(this)},this)):t.resolveWith(this)},this))},a.prototype.member_action=function(e,t){return i.Deferred(i.proxy(function(o){(e||"").indexOf(".")<0&&(e="groupuserajax."+e),n.postJson(e,t,i.proxy(function(e){e.success?o.resolveWith(this,[e.data]):o.rejectWith(this,[e.errors])},this))},this))},new a)},{"./group-actions":1}],3:[function(e,t,o){"use strict";e("./postbox"),e("./groups"),e("./page-groups"),e("./page-groups-categories")},{"./groups":2,"./page-groups":5,"./page-groups-categories":4,"./postbox":6}],4:[function(e,t,o){(function(e){(function(){"use strict";var t,o,r,i,n="undefined"!=typeof window?window.peepso:void 0!==e?e.peepso:null;function s(){s.super_.apply(this,arguments)&&o(o.proxy(this.init_page,this))}t=jQuery,new(o=t,t=peepsodata.groups&&peepsodata.groups.categories||{},r=+t.groups_categories_expand_all,i=+t.groups_categories_group_count||4,peepso.npm.inherits(s,PsPageAutoload),peepso.npm.objectAssign(s.prototype,{init_page:function(){var e,t=this;this._search_$ct.length&&(this._search_$ct.on("click",".ps-js-groups-cat .ps-js-group-category-title",o.proxy(this._toggle,this)),e=this._search_$ct.data("mode")||"grid",+peepsodata.currentuserid&&(e=n.ls.get("groups_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e),o(".ps-js-groups-viewmode").on("click",function(e){e.preventDefault(),e=o(e.currentTarget).data("mode"),+peepsodata.currentuserid&&n.ls.set("groups_viewmode_"+peepsodata.currentuserid,e),t.toggleViewMode(e)}))},_search_url:"groupcategoriesajax.search",_search_params:{keys:"id,name,description,url,groups_count",page:1},_search_debounced:_.debounce(function(){this._fetch(this._search_params).done(function(e){e=this._search_render_html(e&&e.group_categories),this._search_toggle_loading("hide"),e?(this._search_$ct.append(e),this._search_toggle_autoscroll("on")):(this._render_uncategorized(),this._search_$nomore.show())}).fail(function(e){this._search_toggle_loading("hide"),this._search_params.page<=1?this._render_uncategorized().done(o.proxy(function(){this._search_$nomore.show()},this)).fail(o.proxy(function(){this._search_$ct.html(e.join("<br>"))},this)):(this._render_uncategorized(),this._search_$nomore.show())})},500),toggleViewMode:function(e){var t=o(".ps-js-groups-viewmode"),r=t.filter('[data-mode="'.concat(e,'"]')),i=o(".ps-js-groups"),n="ps-btn--active",s="ps-groups__list--single";r.addClass(n),t.not(r).removeClass(n),"list"===e?i.addClass(s):i.removeClass(s)},_search_render_html:function(e){var t,i=this,s=peepso.template(peepsogroupsdata.listCategoriesTemplate),a=null;return e&&e.length&&(a="",_.each(e,function(e){a+=s(_.extend({},e)),t=t||e})),r?setTimeout(o.proxy(function(){this._search_$ct.find(".ps-js-groups-cat").filter(function(){return o(this).find(".ps-js-group-category-action i").hasClass("gci-expand-alt")}).find(".ps-js-group-category-title").trigger("click")},this),1):t&&0<+t.groups_count&&setTimeout(o.proxy(function(){this._unfold_first_row||(this._unfold_first_row=!0,this._search_$ct.find(".ps-js-groups-cat").eq(0).find(".ps-js-group-category-title").trigger("click"))},this),1),setTimeout(function(){var e=i._search_$ct.data("mode")||"grid";+peepsodata.currentuserid&&(e=n.ls.get("groups_viewmode_"+peepsodata.currentuserid)||e),i.toggleViewMode(e)},1),a},_search_get_items:function(){return this._search_$ct.children(".ps-js-group-category-item")},_fetch:function(e){return o.Deferred(o.proxy(function(t){e=o.extend({},e),_.isUndefined(e.limit)||(e.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=peepso.disableAuth().disableError().getJson(this._search_url,e,o.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},_toggle:function(e){"A"===e.target.tagName&&e.target.href.match(/^https?:\/\//)||(e.preventDefault(),e.stopPropagation(),this._toggle_throttled(e))},_toggle_throttled:_.throttle(function(e){var t=o(e.currentTarget).find(".ps-js-group-category-action i"),r=t.closest(".ps-js-groups-cat");e="gcis gci-compress-alt",t.hasClass(e)?(t.attr("class","gcis gci-expand-alt"),r.find(".ps-js-groups").hide(),this._collapse(r)):(t.attr("class",e),r.find(".ps-js-groups").show(),this._expand(r))},500),_expand:function(e){var t,o="ps-js-loaded";e.addClass("ps-groups__category--open"),e.hasClass(o)||(t={uid:peepsodata.currentuserid,user_id:void 0,query:"",group_parent_id:0,category:e.data("id"),order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:i,page:1},ps_groups._fetch(t).done(function(t){e.addClass(o),e.find(".ps-js-groups").html(t),e.find(".ps-js-group-category-footer").show()}).fail(function(t){e.addClass(o),e.find(".ps-js-groups").html(t.join("<br>")),e.find(".ps-js-group-category-footer").remove()}))},_collapse:function(e){e.removeClass("ps-groups__category--open")},_render_uncategorized:function(){var e=this;return o.Deferred(function(t){var o={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:-1,group_parent_id:0,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:1,page:1};ps_groups._fetch(o).done(function(){var o;o=[{id:"-1",name:peepsogroupsdata.lang.uncategorized,url:peepsogroupsdata.group_url.replace("##category_id##","-1"),__uncategorized:!0}],(o=e._search_render_html(o))&&e._search_$ct.append(o),t.resolve()}).fail(function(e){t.reject()})})}}),s)(".ps-js-group-cats")}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,o){(function(t){(function(){"use strict";var o=s("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),r=s("undefined"!=typeof window?window._:void 0!==t?t._:null),i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=function(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return e}();if(t&&t.has(e))return t.get(e);var o,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var n;Object.prototype.hasOwnProperty.call(e,o)&&((n=i?Object.getOwnPropertyDescriptor(e,o):null)&&(n.get||n.set)?Object.defineProperty(r,o,n):r[o]=e[o])}return r.default=e,t&&t.set(e,r),r}("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),n=s(e("./group-actions"));function s(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,o){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){if(e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t))return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(o):t.value})(e,t,o||e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=peepsogroupsdata.listItemTemplate,d=peepsogroupsdata.listItemMemberActionsTemplate;new(function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(s,PsPageAutoload);var e,t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var o,r=l(e);return o=t?(o=l(this).constructor,Reflect.construct(r,arguments,o)):r.apply(this,arguments),r=this,!(o=o)||"object"!==a(o)&&"function"!=typeof o?function(e){if(void 0!==r)return r;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():o}}(s);function s(e){var o;return o=window.location.href.indexOf("channels")>-1?window.location.href.split("&")[1].replace(/\//,""):0,function(e,t){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this),(e=t.call(this,e))._search_url="groupsajax.search",e._search_params={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:0,group_parent_id:o,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:2,page:1},e}return(e=[{key:"onDocumentLoaded",value:function(){var e=this;if(!1===u(l(s.prototype),"onDocumentLoaded",this).call(this))return!1;this._search_$query=(0,o.default)(".ps-js-groups-query"),this._search_$sortby=(0,o.default)(".ps-js-groups-sortby"),this._search_$sortorder=(0,o.default)(".ps-js-groups-sortby-order"),this._search_$category=(0,o.default)(".ps-js-groups-category"),this._search_params.user_id=+peepsodata.userid||void 0,this._search_params.category=this._search_$category.val()||0,this._search_$query.on("input",function(){e._filter()}),this._search_$sortby.on("change",function(){e._filter()}),this._search_$sortorder.on("change",function(){e._filter()}),this._search_$category.on("change",function(t){e._filter_category(t)}),(0,o.default)(".ps-form-search-opt").on("click",function(){e._toggle()});var t=this._search_$ct.data("mode")||"grid";+peepsodata.currentuserid&&(t=i.ls.get("groups_viewmode_"+peepsodata.currentuserid)||t),this.toggleViewMode(t),(0,o.default)(".ps-js-groups-viewmode").on("click",function(t){t.preventDefault(),t=(0,o.default)(t.currentTarget).data("mode"),+peepsodata.currentuserid&&i.ls.set("groups_viewmode_"+peepsodata.currentuserid,t),e.toggleViewMode(t)}),this._filter()}},{key:"toggleViewMode",value:function(e){var t=(0,o.default)(".ps-js-groups-viewmode"),r=t.filter('[data-mode="'.concat(e,'"]')),i=(0,o.default)(".ps-js-groups"),n="ps-btn--active",s="ps-groups__list--single";r.addClass(n),t.not(r).removeClass(n),"list"===e?i.addClass(s):i.removeClass(s)}},{key:"_search_render_html",value:function(e){var t,s,a,u,c,l=(0,i.template)(p),f=((0,i.template)(d),this._search_params.query),h="";if(e.groups&&e.groups.length)for(c=0;c<e.groups.length;c++)(t=e.groups[c]).nameHighlight=t.name||"",u=t.description.match("peepso-markdown"),t.description=u?i.default.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+t.description+"</div>"):(0,o.default)("<div/>").html(t.description||"").text(),f&&(s=r.default.filter(f.split(" "),function(e){return""!==e}),s=r.default.map(s,function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}),s=RegExp("("+s.join("|")+")","ig"),a='<span style="background:'+i.default.getLinkColor(.3)+'">$1</span>',t.nameHighlight=t.nameHighlight.replace(s,a),u||(t.description=(t.description||"").replace(s,a))),h+=l(o.default.extend({},t,{member_actions:""})),r.default.defer(function(e){var t=(0,o.default)(".ps-js-group-item--"+e.id).find(".ps-js-member-actions");e=new n.default({id:e.id,member_actions:e.groupuserajax.member_actions,follower_actions:e.groupfollowerajax.follower_actions}),t.html(e.$el)},t);return h}},{key:"_search_get_items",value:function(){return this._search_$ct.children(".ps-js-group-item")}},{key:"_search_should_load_more",value:function(){var e=+peepsodata.activity_limit_below_fold,t=this._search_get_items();return this._search_loadmore_enable&&this._search_loadmore_repeat?!(t.length>=this._search_loadmore_repeat*this._search_params.page):(e=0<e?e:3,this._search_params.limit&&(e*=this._search_params.limit),!!((e=t.slice(0-e).eq(0)).length&&(this._search_loadmore_enable?e.eq(0).offset():e.get(0).getBoundingClientRect()).top<(window.innerHeight||document.documentElement.clientHeight)))}},{key:"_fetch",value:function(e){var t=this;return o.default.Deferred(function(n){var s=i.default.disableAuth().disableError(),a=t._search_url;e=o.default.extend({},e),t._search_loadmore_enable&&t._search_loadmore_repeat?e.limit=t._search_loadmore_repeat:r.default.isUndefined(e.limit)||(e.limit*=2),t._fetch_xhr&&t._fetch_xhr.abort(),t._fetch_xhr=s.getJson(a,e,function(e){e.success?n.resolveWith(t,[e.data]):n.rejectWith(t,[e.errors])})})}},{key:"_filter",value:function(){this._fetch_xhr&&this._fetch_xhr.abort(),this._search_params.query=o.default.trim(this._search_$query.val()),this._search_params.category=this._search_$category.val(),this._search_params.order_by=this._search_$sortby.val(),this._search_params.order=this._search_$sortorder.val(),this._search_params.page=1,this._search()}},{key:"_filter_category",value:function(e){this._filter();var t=window.location.href,o=/(category=)-?\d+/;e=e.target.value||0,t.match(o)&&(t=t.replace(o,"$1"+e),window.history&&history.pushState&&history.pushState(null,"",t))}},{key:"_toggle",value:function(){(0,o.default)(".ps-js-page-filters").stop().slideToggle()}}])&&function(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(s.prototype,e),s}())(".ps-js-groups")}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./group-actions":1}],6:[function(e,t,o){(function(e){(function(){"use strict";var t=i("undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null),o=(i("undefined"!=typeof window?window._:void 0!==e?e._:null),function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=function(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return e}();if(t&&t.has(e))return t.get(e);var o,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var s;Object.prototype.hasOwnProperty.call(e,o)&&((s=i?Object.getOwnPropertyDescriptor(e,o):null)&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o])}return r.default=e,t&&t.set(e,r),r}("undefined"!=typeof window?window.peepso:void 0!==e?e.peepso:null)),r="undefined"!=typeof window?window.peepsodata:void 0!==e?e.peepsodata:null;function i(e){return e&&e.__esModule?e:{default:e}}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,o){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){if(e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t))return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(o):t.value})(e,t,o||e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=window.peepsogroupsdata.module_id,p=o.observer.applyFilters("class_postbox_dropdown",10,1),d=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(d,p);var e,i=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var o,r=c(e);return o=t?(o=c(this).constructor,Reflect.construct(r,arguments,o)):r.apply(this,arguments),r=this,!(o=o)||"object"!==n(o)&&"function"!=typeof o?u(r):o}}(d);function d(e){var r;return function(e,t){if(!(e instanceof d))throw new TypeError("Cannot call a class as a function")}(this),(r=i.call(this,e.find("#group-tab")[0])).$postbox=e,r.$selected=r.$container.find(".ps-postbox__menu-item-label").hide(),r.$radio=r.$container.find("[type=radio]"),r.$finder=r.$container.find(".ps-js-group-finder"),r.$search=r.$finder.find("input[type=text]"),r.$loading=r.$finder.find(".ps-js-loading"),r.$result=r.$finder.find(".ps-js-result"),r.CATEGORY_ID=void 0,window.peepsoGroupCategory&&(r.CATEGORY_ID=+window.peepsoGroupCategory.id),r.resultTemplate=o.default.template(r.$result.find(".ps-js-result-item-template").text()),r.$dropdown.on("click","[data-option-value]",function(e){var o=(0,t.default)(e.currentTarget).data("optionValue");e.stopPropagation(),r.select(o),"group"!==o&&r.hide()}),r.$postbox.on("postbox.post_cancel postbox.post_saved",function(){return r.remove()}),o.observer.addFilter("postbox_req",t.default.proxy(r.filterPostboxReq,u(r)),10,1),o.observer.addAction("postbox_schedule_set",t.default.proxy(r.actionPostboxScheduleSet,u(r)),10,1),o.observer.addAction("postbox_schedule_reset",t.default.proxy(r.actionPostboxScheduleReset,u(r)),10,1),o.hooks.addFilter("postbox_can_submit","postbox_group",t.default.proxy(r.filterPostboxCanSubmit,u(r))),r}return(e=[{key:"show",value:function(){s(c(d.prototype),"show",this).call(this),this.CATEGORY_ID&&(this.$dropdown.find("[data-option-value] .ps-checkbox").hide(),this.select("group"),this.$finder.show())}},{key:"hide",value:function(){s(c(d.prototype),"hide",this).call(this),this.$radio.get(1).checked&&!this.value()&&(this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide())}},{key:"value",value:function(){var e;return this.$radio.get(1).checked&&this.selectedGroup&&(e=this.selectedGroup),e}},{key:"select",value:function(e){"group"!==e?(this.remove(),this.hide()):"group"===e&&(this.$radio.get(1).checked=!0,this.$finder.show(),this.initFinder())}},{key:"remove",value:function(){this.selectedGroup=void 0,this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide(),o.observer.doAction("postbox_group_reset",this.$postbox)}},{key:"search",value:function(e,t){var i,n,s=this;return e=(e||"").trim(),t=parseInt(t)||1,i={uid:r.currentuserid,user_id:r.currentuserid,group_parent_id:0,category:this.CATEGORY_ID,query:e,writable_only:1,keys:"id,name,description,avatar_url_full,privacy",order_by:"post_title",order:"ASC",limit:10,page:t},n=function(o){o&&o.data&&(s.query=e,s.page=t,s.render(o.data,t),s.searchEnd=!(o.data&&o.data.groups&&o.data.groups.length))},this.xhr&&this.xhr.abort(),this.xhr=o.default.disableAuth().getJson("groupsajax.search",i,n),this.xhr}},{key:"render",value:function(e,t){var o=this.$result.children(".ps-js-result-list");if(e=e||{},1===(t=t||1)&&o.empty(),e&&e.groups&&e.groups.length)for(var i=0;i<e.groups.length;i++)o.append(this.resultTemplate(e.groups[i]));else 1===t&&o.append("<li><em>".concat(r.groups.textNoResult,"</em></li>"))}},{key:"initFinder",value:function(){var e=this;this._initialSearch||(this.$search.on("keydown",t.default.proxy(this.onQueryEnter,this)),this.$search.on("input",t.default.proxy(this.onQueryInput,this)),this.$search.on("click",function(e){return e.stopPropagation()}),this.$result.on("click","[data-id]",t.default.proxy(this.onResultSelect,this)),this.$result.on("scroll",t.default.proxy(this.onResultScroll,this)),this.$result.hide(),this.$loading.show(),this.search().always(function(){e.$loading.hide(),e.$result.show()}),this._initialSearch=!0)}},{key:"onQueryInput",value:function(){var e=this.$search.val(),o=e.replace(/^\s+/,"");e!==o&&this.$search.val(o),this.$result.hide(),this.$loading.show(),clearTimeout(this._onQueryTimer),this._onQueryTimer=setTimeout(t.default.proxy(function(){this.search(o,1).always(t.default.proxy(function(){this.$loading.hide(),this.$result.show()},this))},this),1e3)}},{key:"onQueryEnter",value:function(e){13===e.keyCode&&(e.preventDefault(),e=this.$search.val().replace(/(^\s+|\s+$)/g,""),clearTimeout(this._onQueryTimer),this.$result.hide(),this.$loading.show(),this.search(e,1).always(t.default.proxy(function(){this.$loading.hide(),this.$result.show()},this)))}},{key:"onResultSelect",value:function(e){e=(r=(0,t.default)(e.currentTarget)).data("id");var r=r.data("name");this.selectedGroup=e,this.$container.addClass("active"),this.$selected.html(r).show(),this.hide(),o.observer.doAction("postbox_group_set",this.$postbox,this.selectedGroup)}},{key:"onResultScroll",value:function(e){var t=this;e.stopPropagation(),!this.searchEnd&&this.$loading.is(":hidden")&&this.$result[0].scrollHeight<=this.$result.scrollTop()+this.$result.innerHeight()&&(this.$loading.show(),this.search(this.query,this.page+1).always(function(){return t.$loading.hide()}))}},{key:"filterPostboxReq",value:function(e){var t=this.value();return t&&(e.module_id=l,e.group_id=t,e.force_as_group_post=1,e.acc=void 0),e}},{key:"actionPostboxScheduleSet",value:function(e){e===this.$postbox&&(this.select(""),this.$container.hide())}},{key:"actionPostboxScheduleReset",value:function(e){e===this.$postbox&&this.$container.show()}},{key:"filterPostboxCanSubmit",value:function(e,t){return t===this.$postbox&&this.CATEGORY_ID&&!this.value()&&(e=!1,this.show()),e}}])&&function(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(d.prototype,e),d}();o.observer.addAction("peepso_postbox_addons",function(e){var t={init:function(){},set_postbox:function(e){e.find("#group-tab").length&&new d(e)}};return e.push(t),e},10,1),o.observer.addAction("postbox_init",function(e){e.$el.find("#group-tab").remove()},10,1)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);