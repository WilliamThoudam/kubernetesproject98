!function(e,o){function t(){this.ajax={},this.cover={},this.cover.x_position_percent=0,this.cover.y_position_percent=0,this.$cover_ct=jQuery(".js-focus-cover"),this.$cover_image=peepsogroupsdata.group_id?jQuery("img#"+peepsogroupsdata.group_id):jQuery(),this.initial_cover_position=this.$cover_image.attr("style"),h.observer.addFilter("postbox_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("show_more_posts",function(e){return+peepsogroupsdata.group_id?(e.stream_id=peepsogroupsdata.module_id,e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id):+peepsogroupsdata.group_category_id&&(e.group_category_id=peepsogroupsdata.group_category_id),e},10,1),h.observer.addFilter("photos_validate_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("photos_upload_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("photos_get_list_photos",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("photos_get_list_albums",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("photos_create_album_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("photos_add_photos_to_album_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("photos_remove_temp_files",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("photos_delete_album",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("photos_delete_stream_album",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("peepso_list_videos",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("tags_get_taggable_params",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),h.observer.addFilter("show_avatar_dialog",function(e){return peepsogroupsdata.id?g.proxy(this.showAvatarDialog,this):e},10,1,this),h.observer.addAction("group_name_updated",function(e,o){var t;+peepsogroupsdata.group_id==+e&&(t=g(".ps-js-group-header")).length&&t.find(".ps-focus-title > span").text(o)},10,2,this),h.observer.addAction("group_privacy_updated",function(e,o){+peepsogroupsdata.group_id==+e&&g(".ps-page--group-edit").length&&window.location.reload()},10,2,this)}var g,h;ps_group=(g=e,h=o,t.prototype.init_page=function(t){t&&(this._header_$el=g(".ps-js-group-header"),this._header_$actions=g(".ps-js-group-header-actions"),this._header_$actions_loadingHtml=this._header_$actions.eq(0).html(),this._header_$actions.html(this._header_$actions_loadingHtml),this._get_data(t).done(function(e){this._data=e,h.observer.applyFilters("group_data",e)}),h.observer.addFilter("group_data",g.proxy(function(e){this._update_header_actions(e)},this),10,1),this._header_$actions.on("click",".ps-js-join",g.proxy(function(e){var o=g(e.currentTarget).find("img").show();this.join(t).done(function(e){o.hide(),window.location.reload()})},this)),this._header_$actions.on("click",".ps-js-leave",g.proxy(function(e){var o=g(e.currentTarget).find("img").show();this.leave(t).done(function(e){o.hide(),window.location.reload()})},this)),this.init()),g(document.body).on("click",".ps-js-group-member-action",g.proxy(function(e){var s,o,r,a=g(e.currentTarget);a.data("ps-loading")||(e.preventDefault(),e.stopPropagation(),(s=g.extend({},a.data())).method&&(s.id||t)&&(!(o=a.find("img")).length&&a.parent().hasClass("ps-js-dropdown-menu")&&(o=(o=a.parent().siblings(".ps-js-dropdown-toggle")).find("img"),a.parent().hide()),r=s.method,e=s.confirm,s.group_id=s.id||t,delete s.method,delete s.confirm,delete s.id,this._member_action_confirmation(e).done(function(){0<=r.indexOf("search_to_invite")?this.invite(t):(a.data("ps-loading",!0),o.show(),this.member_action(r,s).done(function(e){var o,t,i=a.closest(".ps-js-member");0<=r.indexOf("passive")?e.reload?window.location.reload():(e.hide?(i.remove(),_.isUndefined(e.pending_user_member_count)||h.observer.doAction("pending_user_member_count",+s.group_id,+e.pending_user_member_count),_.isUndefined(e.pending_admin_member_count)||h.observer.doAction("pending_admin_member_count",+s.group_id,+e.pending_admin_member_count)):(_.isUndefined(e.display_role)||(t=e.display_role,o=i.find('script[data-role="'+t+'"]'),t=i.find(".ps-js-member-role"),o.length?t.html(o.text()).show():t.hide().html("")),e.member_passive_actions&&e.member_passive_actions.length&&(o=h.template(peepsogroupsdata.memberItemActionsTemplate),t={member_passive_actions:e.member_passive_actions,id:s.group_id,passive_user_id:s.passive_user_id},i.find(".ps-js-dropdown").html(o(t)))),+peepsodata.currentuserid==+s.passive_user_id&&(this._header_$actions.html(this._header_$actions_loadingHtml),this._get_data(s.group_id).done(function(e){this._data=e,h.observer.applyFilters("group_data",e)})),h.observer.doAction("notification_clear_cache")):!r.match(/\.?join$/)&&(!(0<=r.indexOf("leave"))||e.member_actions&&1<e.member_actions.length)?this._update_header_actions(e):window.location.reload()}).fail(function(e){a.removeData("ps-loading"),o.hide(),e&&e.length&&pswindow.show("",e.join("<br/>"))}))})))},this)),g(document.body).on("click",".ps-js-groups .ps-js-more",g.proxy(function(e){e.preventDefault(),e.stopPropagation();var e=g(e.currentTarget).closest(".ps-js-group-item"),o=e.find(".ps-js-owner"),t=e.find(".ps-js-categories"),i=e.find(".ps-js-category-icon");+peepsogroupsdata.list_show_owner&&(o.data("ps-loaded")||o.data("ps-loading")||(o.data("ps-loading",!0),this.get_owners(o.data("id")).done(function(e){o.data("ps-loaded",!0),o.removeData("ps-loading"),e&&e.length?o.html('<a href="'+e[0].profileurl+'">'+e[0].fullname+"</a>"):o.html("<em>No owner</em>")}))),t.data("ps-loaded")||t.data("ps-loading")||(t.data("ps-loading",!0),this.get_categories(t.data("id")).done(function(e){t.data("ps-loaded",!0),t.removeData("ps-loading"),e&&e.length?(e=_.map(e,function(e){return'<a href="'+e.url+'">'+e.name+"</a>"}),t.html(e.join(", ")),1<e.length&&i.attr("class","ps-icon-tags")):t.html("<em>No category</em>")}))},this)),g(".ps-js-focus .ps-js-privacy .ps-js-dropdown-menu").on("click","[data-option-value]",function(e){var r,e=g(e.currentTarget),a=e.closest(".ps-js-dropdown-menu").siblings(".ps-js-dropdown-toggle"),e=+e.data("optionValue");e!=+peepsogroupsdata.privacy&&(r={privacy:e,group_id:peepsogroupsdata.group_id,_wpnonce:peepsogroupsdata.nonce_set_group_privacy},pswindow.confirm(peepsogroupsdata.lang.privacy_change_confirmation,function(){var s=a.find("img").show();pswindow.hide(),h.getJson("groupajax.set_group_privacy",r,function(e){var o,t=a.find("i"),i=t.siblings("span");s.hide(),e.success?(o=e.data.new_privacy,peepsogroupsdata.privacy=o.id,t.attr("class",o.icon),i.html(o.name),a.addClass("ps-list-info-success"),setTimeout(function(){a.removeClass("ps-list-info-success")},1e3),h.observer.doAction("group_privacy_updated",r.group_id,{id:o.id,icon:o.icon,name:o.name})):e.errors&&psmessage.show("",e.errors[0])})}))}),g(".ps-js-focus-box-toggle").on("click",function(e){var o=g(".ps-js-focus-desc"),t=g(document),i="click.ps-focusbox-toggle",s="ps-focus__desc--open";e.stopPropagation(),o.hasClass(s)?(o.removeClass(s),t.off(i)):(o.addClass(s),t.one(i,function(){o.removeClass(s)}))})},t.prototype._get_data=function(t){return g.Deferred(g.proxy(function(o){var e={group_id:t,context:"cover",keys:"groupuserajax.member_actions,groupfollowerajax.follower_actions"};h.getJson("groupajax.group",e,g.proxy(function(e){e.success?o.resolveWith(this,[e.data]):o.rejectWith(this,[e.errors])},this))},this))},t.prototype._normalize_header_actions=function(e,i){return _.map(e,function(e){var o=e.label||"",t=o.charAt(0);return t.match(/[a-z]/)&&(o=t.toUpperCase()+o.slice(1)),e.label=o,_.isString(e.action)&&e.action.indexOf(".")<0?e.action=i+"."+e.action:_.isArray(e.action)&&(e.action=this._normalize_header_actions(e.action,i)),e},this)},t.prototype._update_header_actions=function(e){var o,t,i,s=h.template(peepsogroupsdata.headerActionsTemplate);(i=(e=e||{}).group||{}).groupuserajax&&!_.isUndefined(i.groupuserajax.member_actions)?o=i.groupuserajax.member_actions||[]:_.isUndefined(e.member_actions)||(o=e.member_actions||[]),o=o&&this._normalize_header_actions(o,"groupuserajax"),i.groupfollowerajax&&!_.isUndefined(i.groupfollowerajax.follower_actions)?t=i.groupfollowerajax.follower_actions||[]:_.isUndefined(e.follower_actions)||(t=e.follower_actions||[]),t=t&&this._normalize_header_actions(t,"groupfollowerajax"),this._header_actions=this._header_actions||{},this._header_actions.member_actions=o||this._header_actions.member_actions,this._header_actions.follower_actions=t||this._header_actions.follower_actions,this._header_$actions.html(s(this._header_actions)),_.defer(g.proxy(function(){var e,o,t=window.location;t.href.match(/#membership/)&&(e=this._header_$actions.find(".ps-js-btn-membership"),o=e.siblings(".ps-js-dropdown-menu").show(),e.add(o).addClass("ps-list-info-success"),setTimeout(function(){e.add(o).removeClass("ps-list-info-success")},1e3),"replaceState"in window.history&&history.replaceState("",document.title,t.pathname+t.search))},this))},t.prototype.get_owners=function(t){return g.Deferred(g.proxy(function(o){var e={group_id:t,role:"owner",keys:"fullname,profileurl"};h.getJson("groupusersajax.search",e,g.proxy(function(e){e.data&&e.data.members?o.resolveWith(this,[e.data.members]):o.rejectWith(this,[e.errors])},this))},this))},t.prototype.get_members=function(t){return g.Deferred(g.proxy(function(o){var e={group_id:t,keys:"avatar,fullname,profileurl,role"};h.getJson("groupusersajax.search",e,g.proxy(function(e){e.data&&e.data.members?o.resolveWith(this,[e.data.members]):o.rejectWith(this,[e.errors])},this))},this))},t.prototype.get_categories=function(t){return g.Deferred(g.proxy(function(o){var e={group_id:t,keys:"name,url"};h.getJson("groupcategoriesgroupsajax.categories_for_group",e,g.proxy(function(e){e.data&&e.data.categories?o.resolveWith(this,[e.data.categories]):o.rejectWith(this,[e.errors])},this))},this))},t.prototype.join=function(e){return g.Deferred(g.proxy(function(o){h.postJson("groupuserajax.join",{group_id:e},g.proxy(function(e){e.success?o.resolveWith(this,[e.data]):o.rejectWith(this,[e.errors])},this))},this))},t.prototype.leave=function(e){return g.Deferred(g.proxy(function(o){h.postJson("groupuserajax.leave",{group_id:e},g.proxy(function(e){e.success?o.resolveWith(this,[e.data]):o.rejectWith(this,[e.errors])},this))},this))},t.prototype.invite=function(e){h.groups.dlgInvite(e)},t.prototype.inviteUser=function(e,t){return g.Deferred(g.proxy(function(o){h.getJson("groupuserajax.passive_invite",{group_id:e,passive_user_id:t},g.proxy(function(e){e.success?o.resolveWith(this,[e.data]):o.rejectWith(this,[e.errors])},this))},this))},t.prototype.edit_name=function(t,e){var e=g(e).closest(".ps-js-group-name"),i=e.find(".ps-js-group-name-text"),o=e.find(".ps-js-group-name-editor"),s=e.find(".ps-js-btn-edit"),r=e.find(".ps-js-btn-cancel"),a=e.find(".ps-js-btn-submit"),n=o.find("input[type=text]"),p=e.find(".ps-js-limit"),d=n.val();o.is(":visible")||(i.hide(),s.hide(),r.show(),a.show(),o.show(),n.focus(),_.defer(function(){n[0].selectionStart=n[0].selectionEnd=d.length}),n.data("original-value")||(n.data("original-value",d),n.off("input keydown").on("input",function(e){var o=g.trim(n.val()),t=g.trim(n.data("original-value")),i=+n.data("maxlength");i&&o.length>i&&(o=o.substr(0,i),n.val(o)),p.html(i-o.length),o&&o!==t?a.removeAttr("disabled"):a.attr("disabled","disabled")}).on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),a.attr("disabled")||a.click())})),n.trigger("input"),r.off("click").on("click",function(){n.val(n.data("original-value")),o.hide(),a.hide(),r.hide(),s.show(),i.show()}),a.off("click").on("click",g.proxy(function(){var e=peepsogroupsdata.lang.name_change_confirmation;pswindow.confirm(e,g.proxy(function(){var e=a.find("img").show(),o=n.val();pswindow.hide(),this._updateName(t,o).always(function(){e.hide()}).done(function(){n.data("original-value",o),i.text(o),r.click()}).fail(function(e){psmessage.show("",e)})},this),function(){pswindow.hide(),r.click()})},this)))},t.prototype._updateName=function(t,i){var s="_xhr_"+t,e=this._updateName[s];return e&&e.abort(),g.Deferred(g.proxy(function(o){var e=h.postJson("groupajax.set_group_name",{group_id:t,name:i,_wpnonce:peepsogroupsdata.nonce_set_group_name},g.proxy(function(e){e.success?(h.observer.doAction("group_name_updated",t,i),o.resolve()):e.errors?o.reject(e.errors[0]):o.reject()},this));this._updateName[s]=e.ret},this))},t.prototype.edit_slug=function(o,e){var t,s,i,e=g(e).closest(".ps-js-group-slug"),r=e.find(".ps-js-group-slug-text"),a=e.find(".ps-js-group-slug-editor"),n=e.find(".ps-js-group-slug-trigger"),p=e.find(".ps-js-cancel"),d=e.find(".ps-js-submit");a.is(":visible")||(r.hide(),n.hide(),p.show(),d.show(),a.show(),s=a.find(".ps-js-submit"),(t=a.find("input")).data("original-value",i=t.val()),t.focus().val("").val(i),a.off("click input"),p.off("click").on("click",function(){t.val(i),a.hide(),d.hide(),p.hide(),n.show(),r.show()}),d.off("click").on("click",g.proxy(function(e){this.save_slug(o,t.val(),e.currentTarget)},this)),a.on("input","input",function(e){var o=g(e.currentTarget),t=o.closest(".ps-js-group-slug").find(".ps-js-limit"),i=+o.data("maxlength"),e=o.val();i&&e.length>i&&(e=e.substr(0,i),o.val(e)),t.html(i-e.length),g.trim(e)?s.removeAttr("disabled"):s.attr("disabled","disabled")}),t.trigger("input"))},t.prototype.save_slug=function(e,o,t){var i,s="save_slug";this.ajax[s]||(this.ajax[s]=!0,o=g.trim(o),(i=g(t).find(".ps-js-loading")).show(),h.postJson("groupajax.set_group_slug",{group_id:e,slug:o,_wpnonce:peepsogroupsdata.nonce_set_group_slug},g.proxy(function(e){this.ajax[s]=!1,i.hide(),e.success?window.location=e.data.redirect:e.errors&&h.dialog(e.errors[0],{error:!0}).show()},this)))},t.prototype.save_name=function(e,r,a){var n,p="save_name";this.ajax[p]||(this.ajax[p]=!0,r=g.trim(r),(n=g(a).find(".ps-js-loading")).show(),h.postJson("groupajax.set_group_name",{group_id:e,name:r,_wpnonce:peepsogroupsdata.nonce_set_group_name},g.proxy(function(e){var o=g(a).closest(".ps-js-group-name"),t=o.find(".ps-js-group-name-text"),i=o.find(".ps-js-group-name-editor"),s=o.find(".ps-js-group-name-trigger"),o=i.find("input");this.ajax[p]=!1,n.hide(),e.success?(o.val(r),i.off("click").hide(),t.text(r).show(),s.show(),e.data&&e.data.redirect&&(window.location=e.data.redirect)):e.errors&&psmessage.show("",e.errors[0])},this)))},t.prototype.edit_cats=function(t,e){var i,e=g(e).closest(".ps-js-group-cat"),o=e.find(".ps-js-group-cat-text"),s=e.find(".ps-js-group-cat-editor"),r=e.find(".ps-js-btn-edit"),a=e.find(".ps-js-cancel"),n=e.find(".ps-js-submit");s.is(":visible")||(o.hide(),r.hide(),a.show(),n.show(),s.show(),(i=s.find("input[type=checkbox], input[type=radio]")).each(function(){g(this).data("original-value",this.checked)}),s.off("click"),a.off("click").on("click",function(){i.each(function(){this.checked=g(this).data("original-value")}),s.hide(),n.hide(),a.hide(),r.show(),o.show()}),n.off("click").on("click",g.proxy(function(e){var o=i.filter(function(){return this.checked}).map(function(){return+this.value}),o=Array.prototype.slice.call(o);this.save_cats(t,o,e.currentTarget)},this)),s.on("click","input[type=checkbox], input[type=radio]",function(e){var o=s.find(".ps-js-submit");1<=i.filter(function(){return this.checked}).length?o.removeAttr("disabled"):o.attr("disabled","disabled")}))},t.prototype.save_cats=function(e,p,d){var u,c="save_cats";this.ajax[c]||(this.ajax[c]=!0,(u=g(d).find(".ps-js-loading")).show(),h.postJson("groupajax.set_group_categories",{group_id:e,category_id:p,_wpnonce:peepsogroupsdata.nonce_set_group_categories},g.proxy(function(e){var o=g(d).closest(".ps-js-group-cat"),t=o.find(".ps-js-group-cat-text"),i=o.find(".ps-js-group-cat-editor"),s=o.find(".ps-js-btn-edit"),r=o.find(".ps-js-cancel"),a=o.find(".ps-js-submit"),o=i.find("input[type=checkbox], input[type=radio]"),n=[];this.ajax[c]=!1,u.hide(),e.success?(o.each(function(){this.checked=0<=p.indexOf(+this.value),this.checked&&n.push(['<a href="',peepsogroupsdata.group_url.replace("##category_id##",this.value),'">',g(this).next("label").text(),"</a>"].join(""))}),i.off("click").hide(),t.html(n.join("")).show(),a.hide(),r.hide(),s.show()):e.errors&&psmessage.show("",e.errors[0])},this)))},t.prototype.edit_desc=function(o,e){var t,i,e=g(e).closest(".ps-js-group-desc"),s=e.find(".ps-js-group-desc-text"),r=e.find(".ps-js-group-desc-placeholder"),a=e.find(".ps-js-group-desc-editor"),n=e.find(".ps-js-btn-edit"),p=e.find(".ps-js-cancel"),d=e.find(".ps-js-submit");a.is(":visible")||(s.hide(),r.hide(),n.hide(),p.show(),d.show(),a.show(),$submit=a.find(".ps-js-submit"),(t=a.find("textarea")).data("original-value",i=t.val()),t.focus().val("").val(i),a.off("click input"),p.off("click").on("click",function(){t.val(i),a.hide(),d.hide(),p.hide(),n.show(),g.trim(i)?(s.show(),r.hide()):(s.hide(),r.show())}),d.off("click").on("click",g.proxy(function(e){this.save_desc(o,t.val(),e.currentTarget)},this)),a.on("input","textarea",function(e){var o=g(e.currentTarget),t=o.closest(".ps-js-group-desc").find(".ps-js-limit"),i=+o.data("maxlength"),e=o.val();i&&e.length>i&&(e=e.substr(0,i),o.val(e)),t.html(i-e.length),g.trim(e)?$submit.removeAttr("disabled"):$submit.attr("disabled","disabled")}),t.trigger("input"))},t.prototype.save_desc=function(e,d,u){var c,l="save_desc";this.ajax[l]||(this.ajax[l]=!0,d=g.trim(d||""),(c=g(u).find(".ps-js-loading")).show(),h.postJson("groupajax.set_group_description",{group_id:e,description:d,_wpnonce:peepsogroupsdata.nonce_set_group_description},g.proxy(function(e){var o=g(u).closest(".ps-js-group-desc"),t=o.find(".ps-js-group-desc-text"),i=o.find(".ps-js-group-desc-placeholder"),s=o.find(".ps-js-group-desc-editor"),r=o.find(".ps-js-btn-edit"),a=o.find(".ps-js-cancel"),n=o.find(".ps-js-submit"),p=s.find("textarea"),o=g(".ps-js-focus-desc");this.ajax[l]=!1,c.hide(),e.success?(p.val(d),s.off("click").hide(),n.hide(),a.hide(),r.show(),d=(d=_.escape(g.trim(d))).replace(/(?:\r\n|\r|\n)/g,"<br />"),n=t.find(".peepso-markdown"),r=a=d,n.length&&(r=h.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+r+"</div>")),a?(t.html(r).show(),i.hide(),o.html(r)):(t.text(r).hide(),i.show(),o.text(r))):e.errors&&psmessage.show("",e.errors[0])},this)))},t.prototype._member_action_confirmation=function(o){return g.Deferred(g.proxy(function(e){o?pswindow.confirm(o,g.proxy(function(){pswindow.hide(),e.resolveWith(this)},this),g.proxy(function(){e.rejectWith(this)},this)):e.resolveWith(this)},this))},t.prototype.member_action=function(e,t){return g.Deferred(g.proxy(function(o){(e||"").indexOf(".")<0&&(e="groupuserajax."+e),h.postJson(e,t,g.proxy(function(e){e.data?o.resolveWith(this,[e.data]):o.rejectWith(this,[e.errors])},this))},this))},t.prototype.init=function(){jQuery(".js-focus-cover").hover(function(){!1===pswindow.is_visible&&jQuery(".js-focus-change-cover").show()},function(){jQuery(".js-focus-change-cover").hide()}),jQuery(".ps-tab__bar").unbind("click");var e=this;this.$cover_image.one("load",function(){e.fix_horizontal_padding()}).each(function(){this.complete&&jQuery(this).trigger("load")}),jQuery(window).on("resize.focus-image",jQuery.proxy(this.fix_horizontal_padding_debounced,this))},t.prototype.fix_horizontal_padding=function(){var e;this.$cover_image.css({height:"auto",width:"100%",minWidth:"100%",maxWidth:"100%"}),e=.375*this.$cover_ct.width(),e=Math.max(e,this.$cover_ct.height()),this.$cover_image.height()<e&&this.$cover_image.css({height:e,width:"auto",minWidth:"100%",maxWidth:"none"}),this.initial_cover_position=this.$cover_image.attr("style")},t.prototype.fix_horizontal_padding_debounced=_.debounce(function(){this.fix_horizontal_padding()},300),t.prototype.show_avatar_dialog=function(){jQuery(".ps-js-error").html("");var e=jQuery("#dialog-upload-avatar"),o=e.find("#dialog-upload-avatar-title").html(),t=e.find("#dialog-upload-avatar-content").html(),e=e.find(".dialog-action").html(),i=pswindow.show(o,t).set_actions(e).$container.find(".ps-dialog");i.addClass("ps-dialog-wide"),h.observer.addFilter("pswindow_close",function(){i.removeClass("ps-dialog-wide")},10,1),this.init_avatar_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-avatar .fileupload:visible").psFileupload("destroy")})},t.prototype.init_avatar_fileupload=function(){var r=this;jQuery(".upload-avatar .fileupload:visible").psFileupload({formData:{group_id:peepsogroupsdata.group_id,_wpnonce:jQuery("#_covernonce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"groupajax.avatar_upload?avatar",add:function(e,o){var t;o.files[0].type.length&&!/(\.|\/)(jpe?g|png)$/i.test(o.files[0].type)?(t=jQuery("#profile-avatar-error-filetype").text(),jQuery(".ps-js-error").html(t)):parseInt(o.files[0].size)>peepsodata.upload_size?(t=jQuery("#profile-avatar-error-filesize").text(),jQuery(".ps-js-error").html(t)):(jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").hide(),jQuery(".ps-js-error").hide(),pswindow.refresh(),o.submit())},done:function(e,o){var t,i,s=o.result;s.success?(t=jQuery("#dialog-upload-avatar-content",jQuery(s.data.html)),i=jQuery("#dialog-upload-avatar .dialog-action").html(),o="?"+Math.random(),jQuery(".js-focus-avatar img",t).attr("src",s.data.image_url+o),jQuery(".imagePreview img",t).attr("src",s.data.orig_image_url+o),jQuery(".imagePreview",t).after('<input type="hidden" name="is_tmp" value="1"/>'),jQuery(".ps-js-has-avatar",t).show(),jQuery(".ps-js-no-avatar",t).hide(),pswindow.set_content(t),pswindow.set_actions(i),jQuery("#imagePreview img").one("load",function(){pswindow.refresh()}),r.init_avatar_fileupload(),jQuery("#ps-window button[name=rep_submit]").removeAttr("disabled").addClass("ps-btn-primary"),r.invalid_avatar_upload=!1,r.avatar_use_gravatar=!1):(jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").show(),jQuery(".ps-js-error").html(s.errors).show(),jQuery("#ps-window .ps-loading-image").hide(),jQuery("#ps-window button[name=rep_submit]").attr("disabled","disabled").removeClass("ps-btn-primary"),r.invalid_avatar_upload=!0)}})},t.prototype.confirm_avatar=function(o){var t,e;this.invalid_avatar_upload||(t=this.confirm_avatar)._loading||(t._loading=!0,o&&(o=jQuery(o)).attr("disabled","disabled"),e={group_id:peepsogroupsdata.group_id,module_id:peepsogroupsdata.module_id,_wpnonce:jQuery("#_covernonce").val()},h.postJson("groupajax.avatar_confirm",e,function(e){e&&e.success?window.location.reload():(t._loading=!1,o&&o.removeAttr("disabled"))}))},t.prototype.confirm_remove_avatar=function(){var e=jQuery("#delete-confirmation #delete-title").html(),o=jQuery("#delete-confirmation #delete-content").html();pswindow.show(e,o)},t.prototype.remove_avatar=function(e){e={group_id:peepsogroupsdata.group_id,user_id:e,_wpnonce:jQuery("#_covernonce").val()};h.postJson("groupajax.avatar_delete",e,function(e){e.success&&window.location.reload()})},t.prototype.confirm_remove_cover_photo=function(){var e=jQuery("#delete-confirmation #delete-title").html(),o=jQuery("#delete-confirmation #delete-content").html();pswindow.show(e,o)},t.prototype.remove_cover_photo=function(e){var o={group_id:peepsogroupsdata.group_id,_wpnonce:jQuery("#_covernonce").val()};h.postJson("groupajax.cover_delete",o,function(e){e.success&&window.location.reload()})},t.prototype.reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").hide(),jQuery(".js-focus-change-cover > a",".js-focus-cover").hide(),jQuery(".reposition-cover-actions",".js-focus-cover").show(),jQuery(".js-focus-cover").addClass("ps-focus-cover-edit");var r=this,t=jQuery(".js-focus-cover").height()-jQuery("img#"+peepsogroupsdata.group_id).height(),i=jQuery(".js-focus-cover").width()-jQuery("img#"+peepsogroupsdata.group_id).width();jQuery("img#"+peepsogroupsdata.group_id).draggable({cursor:"move",drag:function(e,o){o.position.top<t&&(o.position.top=t),0<o.position.top&&(o.position.top=0),o.position.left<i&&(o.position.left=i),0<o.position.left&&(o.position.left=0)},stop:function(e,o){var t=jQuery("img#"+peepsogroupsdata.group_id),i=t.closest(".js-focus-cover"),s=100*o.position.top/i.height(),s=Math.round(1e4*s)/1e4;y=100*o.position.left/i.width(),y=Math.round(1e4*y)/1e4,r.cover.x_position_percent=s,r.cover.y_position_percent=y,t.css("top",s+"%"),t.css("left",y+"%")}})},t.prototype.cancel_reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").show(),jQuery(".js-focus-change-cover > a",".js-focus-cover").show(),jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),jQuery("img#"+peepsogroupsdata.group_id).attr("style",this.initial_cover_position),jQuery("img#"+peepsogroupsdata.group_id).draggable("destroy")},t.prototype.save_reposition_cover=function(){var e={group_id:peepsogroupsdata.group_id,x:this.cover.x_position_percent,y:this.cover.y_position_percent,_wpnonce:jQuery("#_covernonce").val()},o=this;jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".ps-reposition-loading",".js-focus-cover").show(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),h.postJson("groupajax.cover_reposition",e,function(e){jQuery(".ps-reposition-loading",".js-focus-cover").hide(),o.initial_cover_position=jQuery("img#"+peepsogroupsdata.group_id).attr("style"),o.cancel_reposition_cover()})},t.prototype.show_cover_dialog=function(){jQuery(".ps-js-error").html("");var e=jQuery("#dialog-upload-cover"),o=e.find("#dialog-upload-cover-title").html(),e=e.find("#dialog-upload-cover-content").html();pswindow.show(o,e),this.init_cover_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-cover .fileupload:visible").psFileupload("destroy")})},t.prototype.init_cover_fileupload=function(){var t=this;jQuery(".upload-cover .fileupload:visible").psFileupload({formData:{group_id:peepsogroupsdata.group_id,module_id:peepsogroupsdata.module_id,_wpnonce:jQuery("#_covernonce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"groupajax.cover_upload?cover",add:function(e,o){var t;o.files[0].type.length&&!/(\.|\/)(jpe?g|png)$/i.test(o.files[0].type)?(t=jQuery("#profile-cover-error-filetype").text(),jQuery(".ps-js-error").html(t)):parseInt(o.files[0].size)>peepsodata.upload_size?(t=jQuery("#profile-cover-error-filesize").text(),jQuery(".ps-js-error").html(t)):(jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .upload-cover").hide(),o.submit())},done:function(e,o){o=o.result;jQuery("#ps-window .ps-loading-image").hide(),jQuery("#ps-window .upload-cover").show(),o.success?(jQuery(".cover-image").attr("src",o.data.image_url+"?"+Math.random()).css("top","0").css("left","0").removeClass("default").addClass("has-cover"),pswindow.fade_out("slow"),jQuery("#profile-reposition-cover").show(),jQuery("#dialog-upload-cover-content").html(o.data.html),pswindow.set_content(jQuery("#dialog-upload-cover-content",o.data.html).html()),t.fix_horizontal_padding_debounced(),t.init_cover_fileupload()):jQuery(".ps-js-error").html(o.errors)}})},t.prototype.showAvatarDialog=function(){var e;peepsogroupsdata.id&&(this.avatarDialog||((e={id:+peepsogroupsdata.id,name:peepsogroupsdata.name,hasAvatar:+peepsogroupsdata.hasAvatar,imgAvatar:peepsogroupsdata.imgAvatar,imgOriginal:peepsogroupsdata.imgOriginal}).hasAvatar||(e.imgOriginal=""),this.avatarDialog=new PsGroupAvatarDialog(e)),this.avatarDialog.show())},t.prototype.edit_property=function(e,i,s){var e=g(e).closest(".ps-js-group-"+s),r=e.find(".ps-js-text"),o=e.find(".ps-js-editor"),t=e.find(".ps-js-btn-edit"),a=e.find(".ps-js-btn-cancel"),n=e.find(".ps-js-btn-submit"),p=o.find('select[name="'+s+'"]'),e=p.val();o.is(":visible")||(r.hide(),t.hide(),a.show(),n.show(),o.show(),p.data("psInitialized")||(p.data("psInitialized",1),p.data("initialValue",e),p.off("change").on("change",function(){var e=g(this),o=e.val(),e=e.data("initialValue");o&&o!==e?n.removeAttr("disabled"):n.attr("disabled","disabled")}),a.off("click").on("click",function(){p.val(p.data("initialValue")),o.hide(),n.hide(),a.hide(),t.show(),r.show()}),n.off("click").on("click",function(){var o=n.find("img"),t=p.val();o.is(":visible")||(o.show(),h.postJson("groupajax.set_group_property",{group_id:i,property_name:s,property_value:t,_wpnonce:peepsogroupsdata.nonce_set_group_property},function(e){o.hide(),e.success&&(p.data("initialValue",t),r.html(p.children("option:selected").text())),a.click()}))})))},new t),e(function(){ps_group.init_page(+peepsogroupsdata.group_id)})}(jQuery,peepso);