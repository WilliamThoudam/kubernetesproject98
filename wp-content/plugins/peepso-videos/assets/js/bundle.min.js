!function n(i,r,s){function a(e,t){if(!r[e]){if(!i[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(u)return u(e,!0);throw(o=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",o}o=r[e]={exports:{}},i[e][0].call(o.exports,function(t){return a(i[e][1][t]||t)},o,o.exports,n,i,r,s)}return r[e].exports}for(var u="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(i,t,e){(function(n){(function(){"use strict";var u=o("undefined"!=typeof window?window.jQuery:void 0!==n?n.jQuery:null),t=o("undefined"!=typeof window?window._:void 0!==n?n._:null),e="undefined"!=typeof window?window.peepso:void 0!==n?n.peepso:null;function o(t){return t&&t.__esModule?t:{default:t}}var l="probably"===(0,i("./video").supportsType)("webm");(0,u.default)(document).on("ps_activitystream_loaded",t.default.throttle(function(){(0,u.default)(".ps-js-activity").not("[data-video-init]").each(function(){var e,t,o,n,i,r,s,a=(0,u.default)(this).attr("data-video-init","").find(".ps-js-video");a.length&&(o=(e=a).find(".ps-video-thumbnail"),a=o.find(".ps-js-media-play"),n=o.find("img"),i=n.attr("src"),r=n.data("animated"),s=n.data("animated-webm"),o.on("mouseenter",function(){s&&l?t?(n.hide(),t.show(),t.get(0).play()):(t=(0,u.default)('<video src="'.concat(s,'" />'))).get(0).addEventListener("loadeddata",function(){n.hide(),t.insertAfter(n),t.show(),t.get(0).play()}):r&&n.attr("src",r)}).on("mouseleave",function(){s&&l?t&&(t.hide(),t.get(0).pause(),n.show()):r&&n.attr("src",i)}),a.on("click",function(){var t=e.children("script").text();e.html(t)}))})},3e3));t=navigator.userAgent,t=-1<t.indexOf("Safari")&&-1===t.indexOf("Chrome");(e.browser.isIOS()||t)&&e.observer.addFilter("peepso_activity",function(t){return t.each(function(){var t,e=(0,u.default)(this).find("audio.wp-audio-shortcode");!e.length||(t=e.find("source")).length&&(e.attr("src",t.attr("src")),t.remove())})},10,1)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./video":17}],2:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n,r=(n=t("eventemitter3"))&&n.__esModule?n:{default:n};function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(o){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=l(o);return t=n?(t=l(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==i(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(i,r.default);var t,e,o,n=u(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).source=t,e.data=null,e}return t=i,(e=[{key:"fetch",value:function(){throw new Error("Must be implemented by subclass!")}},{key:"fetchAbort",value:function(){throw new Error("Must be implemented by subclass!")}},{key:"getHTML",value:function(){var t=this;return new Promise(function(e,o){t.fetch().then(function(t){e(t.html)}).catch(function(t){o(t)})})}},{key:"getData",value:function(){var t=this;return new Promise(function(e,o){t.fetch().then(function(t){e(t)}).catch(function(t){o(t)})})}}])&&s(t.prototype,e),o&&s(t,o),i}();o.default=d},{eventemitter3:19}],3:[function(n,t,c){(function(o){(function(){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var r=t("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null),s=t(n("./abstract"));function t(t){return t&&t.__esModule?t:{default:t}}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(o){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=d(o);return t=n?(t=d(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==i(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var e=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(i,s.default);var t,e,o,n=l(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n.apply(this,arguments)}return t=i,(e=[{key:"fetch",value:function(){var n=this;return new Promise(function(e,o){var t;n.data?e(n.data):(t={url:n.source,accepted_type:"audio"},n.xhr=r.default.postJson("videosajax.get_preview",t,function(t){t.success?(n.data=t.data,e(n.data)):o(t&&t.errors&&t.errors[0])}).ret)})}},{key:"fetchAbort",value:function(){this.xhr&&(this.xhr.abort(),this.xhr=void 0)}}])&&a(t.prototype,e),o&&a(t,o),i}();c.default=e}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./abstract":2}],4:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n,i=(n=t("./embed"))&&n.__esModule?n:{default:n};function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(o){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=u(o);return t=n?(t=u(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==r(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,i.default);var t=a(e);function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t.apply(this,arguments)}return e}();o.default=l},{"./embed":3}],5:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var r=n(t("./abstract")),s=n(t("../uploader"));function n(t){return t&&t.__esModule?t:{default:t}}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(o){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=d(o);return t=n?(t=d(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==i(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(i,r.default);var t,e,o,n=l(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n.apply(this,arguments)}return t=i,(e=[{key:"fetch",value:function(){var n=this;return new Promise(function(e,o){n.data?e(n.data):n.validate().then(function(){n.upload().then(function(t){n.data=_.extend({},t,{html:'<iframe src="'.concat(t.link,'embed" />')}),e(n.data)}).catch(function(t){o(t)})}).catch(function(t){o(t)})})}},{key:"validate",value:function(){var n=this;return new Promise(function(e,o){var t=n.source.files[0],t={type:t.type,size:parseInt(t.size)};peepso.postJson("videosajax.validate_video_upload",t,function(t){t&&t.success?e():o(t&&t.errors&&t.errors[0])})})}},{key:"upload",value:function(){var n=this;return new Promise(function(e,o){var t=new s.default(n.source);t.on("progress",function(t){n.emit("progress",t)}),t.upload().then(function(t){e(t)}).catch(function(t){o(t)})})}}])&&a(t.prototype,e),o&&a(t,o),i}();o.default=t},{"../uploader":12,"./abstract":2}],6:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.supportsType=o.default=void 0;var r=n(t("eventemitter3")),s=n(t("./file")),a=n(t("./embed"));n(t("./facebook"));function n(t){return t&&t.__esModule?t:{default:t}}function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(o){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=i(o);return t=n?(t=i(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==u(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var p,t=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(i,r.default);var t,e,o,n=c(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).source=t,e.object=null,"object"===u(t)&&t.nodeType?(e.object=new s.default(t),e.object.on("progress",function(t){e.emit("progress",t)})):"string"==typeof t&&""!==t&&(e.object=new a.default(t)),e}return t=i,(e=[{key:"fetchAbort",value:function(){return this.object.fetchAbort()}},{key:"getHTML",value:function(){return this.object.getHTML()}},{key:"getData",value:function(){return this.object.getData()}}])&&l(t.prototype,e),o&&l(t,o),i}();o.default=t;o.supportsType=function(t){return(p=p||document.createElement("video"))&&"function"==typeof p.canPlayType?p.canPlayType({ogg:'video/ogg; codecs="theora"',h264:'video/mp4; codecs="avc1.42E01E"',webm:'video/webm; codecs="vp8, vorbis"',vp9:'video/webm; codecs="vp9"',hls:'application/x-mpegURL; codecs="avc1.42E01E"'}[t]||t):""}},{"./embed":3,"./facebook":4,"./file":5,eventemitter3:19}],7:[function(t,e,h){(function(f){(function(){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var t,a=(t="undefined"!=typeof window?window.jQuery:void 0!==f?f.jQuery:null)&&t.__esModule?t:{default:t},n=e("undefined"!=typeof window?window.peepso:void 0!==f?f.peepso:null),r=e("undefined"!=typeof window?window.peepsodata:void 0!==f?f.peepsodata:null);function u(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return u=function(){return t},t}function e(t){if(t&&t.__esModule)return t;if(null===t||"object"!==s(t)&&"function"!=typeof t)return{default:t};var e=u();if(e&&e.has(t))return e.get(t);var o,n,i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&((n=r?Object.getOwnPropertyDescriptor(t,o):null)&&(n.get||n.set)?Object.defineProperty(i,o,n):i[o]=t[o]);return i.default=t,e&&e.set(t,i),i}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}function d(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var c=function(){function s(){l(this,s)}return o(s,null,[{key:"create",value:function(){var t=s.$outer,e=s.$inner;return t||((e=s.$inner=(0,a.default)("<div />").append(r.media.templateCard)).css({position:"absolute"}),(t=s.$outer=(0,a.default)("<div />").css({display:"none",height:1,overflow:"visible",position:"absolute",width:1,zIndex:100001})).on("mouseenter",function(t){t.stopPropagation(),s.show()}),t.on("mouseleave",function(t){t.stopPropagation(),s.hide()}),t.append(e).appendTo(document.body)),t}},{key:"show",value:function(t,e){clearTimeout(s.hideTimer);var o,n,i=s.create(),r=s.$inner;"loading"===t?i.find(".ps-js-loading").show():t&&(i.find(".ps-js-loading").hide(),i.find(".ps-js-cover").css({backgroundImage:"url(".concat(encodeURI(t.cover),")")}),t.artist?i.find(".ps-js-artist").html(t.artist).show():i.find(".ps-js-artist").hide(),t.album?i.find(".ps-js-album").html(t.album).show():i.find(".ps-js-album").hide()),i.show(),e&&e.currentTarget&&e.clientX&&(n=(o=(0,a.default)(e.currentTarget)).offset(),t=window.innerWidth<=480,r.css({top:"",left:0,bottom:0,right:t?0:""}),i.css({top:n.top-i.height(),left:t?0:e.clientX,right:t?0:"",width:t?"":1}),(e=r.get(0).getBoundingClientRect()).top<0&&(i.css({top:n.top+o.height()}),r.css({bottom:"",top:0})),t||e.right>(window.innerWidth||document.documentElement.clientWidth)&&r.css({left:"",right:0}))}},{key:"hide",value:function(){var t=s.$outer;t&&(s.hideTimer=setTimeout(function(){t.hide()},200))}}]),s}();d(c,"$outer",void 0),d(c,"$inner",void 0),d(c,"hideTimer",void 0);var p=function(){function i(t,e){var o=this;l(this,i),d(this,"$elem",void 0),d(this,"opts",void 0),d(this,"showTimer",void 0),this.$elem=(0,a.default)(t),this.opts=e,this.$elem.on("mouseenter",function(t){t.stopPropagation(),o.show(t)}),this.$elem.on("mouseleave",function(t){t.stopPropagation(),o.hide()}),n.default.isTouch()&&this.$elem.on("click",function(t){t.preventDefault(),t.stopPropagation()})}return o(i,[{key:"getData",value:function(){var t=this;return new n.Promise(function(e){var o=t.opts.artist+":"+t.opts.album,n=i.cache[o];n?e(n):a.default.post(r.default.ajaxurl,{action:"peepso_audio_album_info",artist:t.opts.artist,album:t.opts.album},function(t){n=i.cache[o]=t,e(n)},"json")})}},{key:"show",value:function(o){var n=this;this.showTimer=setTimeout(function(){var e=setTimeout(function(){c.show("loading",o)},500);n.getData().then(function(t){clearTimeout(e),n.showTimer&&c.show(t,o)})},300)}},{key:"hide",value:function(){clearTimeout(this.showTimer),this.showTimer=null,c.hide()}}]),i}();d(p,"cache",{}),h.default=p,(0,a.default)(function(){var t=n.default.isTouch()?"touchstart":"mouseenter";(0,a.default)(document).on(t,"[data-artist][data-album]",function(t){var e,o,n=(0,a.default)(t.currentTarget);n.data("ps-mediacard")||(e=n.data("artist"),o=n.data("album"),e&&o?(o=new p(n[0],{artist:e,album:o}),n.data("ps-mediacard",o),o.show(t)):n.data("ps-mediacard","do_not_trigger"))})})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(r,t,e){(function(i){(function(){"use strict";var t="undefined"!=typeof window?window.peepso:void 0!==i?i.peepso:null,o=(e(r("./videos")),e(r("./page-videos")),e(r("./postbox"))),n=e(r("./postbox-audio"));function e(t){return t&&t.__esModule?t:{default:t}}r("./activitystream"),r("./card"),t.observer.addFilter("peepso_postbox_addons",function(t){var e={init:function(){},set_postbox:function(t){new o.default(t),new n.default(t)}};return t.push(e),t},10,1)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./activitystream":1,"./card":7,"./page-videos":9,"./postbox":11,"./postbox-audio":10,"./videos":18}],9:[function(t,e,o){(function(o){(function(){"use strict";var t,r=(t="undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null)&&t.__esModule?t:{default:t},s="undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null;function e(){e.super_.apply(this,arguments),(0,r.default)(r.default.proxy(this.init_page,this))}(0,r.default)(function(){var e=["small","large"],o=(0,r.default)(".ps-js-media-viewmode"),n=(0,r.default)(".ps-js-videos");function i(t){t=0<=e.indexOf(t)?t:e[0],o.removeClass("ps-btn--active"),o.filter('[data-mode="'.concat(t,'"]')).addClass("ps-btn--active"),n.removeClass(e.map(function(t){return"ps-media__page-list--".concat(t)}).join(" ")),n.addClass("ps-media__page-list--".concat(t)),s.ls.set("media_viewmode",t)}o.length&&n.length&&(i(s.ls.get("media_viewmode")),o.on("click",function(t){t.preventDefault(),i((0,r.default)(this).data("mode"))}))}),new(peepso.npm.inherits(e,PsPageAutoload),peepso.npm.objectAssign(e.prototype,{init_page:function(){this._search_$sortby=(0,r.default)(".ps-js-videos-sortby").on("change",r.default.proxy(this._filter,this)),this._search_$sortby.length&&this._search_$sortby.trigger("change"),peepso.observer.addAction("peepso_delete_post",function(t){(0,r.default)(".ps-js-video").filter('[data-post-id="'+t+'"]').remove()},10,1)},_search_url:"videosajax.get_user_videos",_search_params:{uid:peepsodata.currentuserid,user_id:peepsodata.userid,sort:void 0,limit:3,page:1},_search_render_html:function(t){return t.videos||""},_search_get_items:function(){return this._search_$ct.children(".ps-js-video")},_fetch:function(t){return r.default.Deferred(r.default.proxy(function(e){t=peepso.observer.applyFilters("peepso_list_videos",t),t=r.default.extend({},t),_.isUndefined(t.limit)||(t.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=peepso.getJson(this._search_url,t,r.default.proxy(function(t){t.success?e.resolveWith(this,[t.data]):e.rejectWith(this,[t.errors])},this))},this))},_filter:function(){var t=this._search_$sortby.val();this._fetch_xhr&&this._fetch_xhr.abort(),this._search_params.sort=t||void 0,this._search_params.page=1,this._search()}}),e)(".ps-js-videos")}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(n,t,c){(function(o){(function(){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var i=t("undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null),r=t("undefined"!=typeof window?window._:void 0!==o?o._:null),a=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==s(t)&&"function"!=typeof t)return{default:t};var e=l();if(e&&e.has(t))return e.get(t);var o,n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in t){var r;Object.prototype.hasOwnProperty.call(t,o)&&((r=i?Object.getOwnPropertyDescriptor(t,o):null)&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=t[o])}n.default=t,e&&e.set(t,n);return n}("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null),u=t(n("./audio"));function l(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return l=function(){return t},t}function t(t){return t&&t.__esModule?t:{default:t}}function d(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var e=function(){function e(t){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=window.peepsoaudiodata||{},this.$postbox=t,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxAudio=this.$postbox.find(".ps-postbox-tabs [data-tab-id=audio]"),this.$postboxAudioShortcut=this.$postbox.find("#audio-post"),this.$postboxTab.on("peepso_posttabs_show-audio",function(){o.show()}),this.$postboxTab.on("peepso_posttabs_cancel-audio",function(){o.cancel()}),this.$postboxTab.on("peepso_posttabs_submit-audio",function(){o.post()}),this.$postboxAudioShortcut.on("click",function(){o.$postboxTab.find("[data-tab=audio]").click()}),a.observer.addAction("postbox_type_set",i.default.proxy(function(t,e){t===this.$postbox&&"audio"===e&&this.$postboxAudioShortcut.trigger("click")},this),10,2),this.$embed=this.$postbox.find(".ps-js-audio-embed"),this.$embedUrl=this.$embed.find(".ps-js-url"),this.$embedLoading=this.$embed.find(".ps-js-loading"),this.$embedUrl.on("input",r.default.debounce(function(t){return o.embed(t.target.value)},2e3)),this.$embedUrl.on("paste",function(t){return r.default.defer(function(){return o.embed(t.target.value)})}),this.$embedUrl.on("blur",function(t){o.$uploadBtn.off("click"),r.default.defer(function(){return o.$uploadBtn.on("click",function(){return o.onUploadClick()})}),o.embed(t.target.value)}),this.$upload=this.$postbox.find(".ps-js-audio-upload"),this.$uploadBtn=this.$upload.find(".ps-js-btn"),this.$uploadForm=this.$upload.find(".ps-js-form"),this.$uploadTitle=this.$upload.find(".ps-js-title"),this.$uploadArtist=this.$upload.find(".ps-js-artist"),this.$uploadAlbum=this.$upload.find(".ps-js-album"),this.$uploadProgress=this.$upload.find(".ps-js-progress"),this.$uploadDone=this.$upload.find(".ps-js-done"),this.$uploadFailed=this.$upload.find(".ps-js-failed"),this.$uploadSuccess=this.$upload.find(".ps-js-success"),this.$uploadBtn.on("click",function(){return o.onUploadClick()}),this.$separator=this.$postbox.find(".ps-js-audio-separator"),this.$preview=this.$postbox.find(".ps-js-audio-preview"),this.mode=null,this.data=null,this.$uploadTitle.on("input",r.default.throttle(function(){o.$postbox.on_change()},500)),a.observer.addFilter("peepso_postbox_can_submit",function(t,e){return o.$postbox===e&&"audio"===o.$postboxTab.current_tab_id&&("embed"===o.mode?t.hard.push(!!o.data):"upload"===o.mode&&(e=o.$uploadTitle.val().trim(),t.hard.push(!(!o.data||!e)))),t},10,2),a.observer.addFilter("peepso_postbox_onsave",function(t,e){return o.$postbox===e&&"audio"===o.$postboxTab.current_tab_id&&("upload"!==o.mode||o.data&&o.data.is_audio||(o.uploadShowNotice=!0)),t},10,2),this.$postbox.on("postbox.post_saved",function(){var t;o.uploadShowNotice&&(delete o.uploadShowNotice,(t=o.$uploadSuccess.clone()).show().insertAfter(o.$postbox),t.delay(3e3).fadeOut("slow",function(){t.remove()}))}),this.uploadInit(),this.uploadInitialized=!0}var t,o,n;return t=e,(o=[{key:"show",value:function(){this.mode=null,this.$postboxAudioShortcut.addClass("active"),this.$postboxAudio.show(),this.$embed.show(),this.$separator.show(),this.$upload.show(),this.$uploadBtn.show(),this.$uploadForm.hide(),this.$uploadSuccess.hide(),this.$preview.hide(),+this.config.upload_enable?this.$postboxStatus.hide():(this.$postboxStatus.show(),this.mode="embed")}},{key:"showEmbed",value:function(){this.mode="embed",this.$postboxStatus.show(),this.$embed.show(),this.$separator.hide(),this.$upload.hide(),this.$preview.show()}},{key:"showUpload",value:function(){this.mode="upload",this.$postboxStatus.show(),this.$embed.hide(),this.$separator.hide(),this.$upload.show(),this.$uploadTitle.val(""),this.$uploadArtist.val(""),this.$uploadAlbum.val(""),this.$uploadBtn.hide(),this.$uploadForm.show(),this.$uploadProgress.show(),this.$uploadDone.hide(),this.$uploadFailed.hide(),this.$preview.show()}},{key:"cancel",value:function(){this.mode=null,this.data=null,this.$postboxAudioShortcut.removeClass("active"),this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.$postbox.on_change()}},{key:"post",value:function(){var t="postbox_req_"+this.$postbox.guid;a.observer.addFilter(t,this.postSetRequest,10,1,this),this.$postbox.save_post(),a.observer.removeFilter(t,this.postSetRequest,10)}},{key:"postSetRequest",value:function(t){return"embed"===this.mode?r.default.extend(t,{type:"audio",url:this.data.url}):"upload"===this.mode&&r.default.extend(t,{type:"audio",audio:this.data.file,audio_title:this.$uploadTitle.val().trim(),audio_artist:this.$uploadArtist.val().trim(),audio_album:this.$uploadAlbum.val().trim()}),t}},{key:"embed",value:function(t){var e=this,t=0<arguments.length&&void 0!==t?t:"";(t=t.trim()).match(/^https?:\/\//i)&&t!==this._embedUrl&&(this._embedUrl=t,this.audio&&this.audio.fetchAbort(),this.showEmbed(),this.$embedLoading.show(),this.audio=new u.default(t),this.audio.getHTML().then(function(t){e.$preview.html(t),e.audio.getData().then(function(t){e.data=t,e.$postbox.on_change()})}).catch(function(t){e.$embedUrl.val(e._embedUrl=""),(0,a.dialog)(t,{error:!0}).show()}).finally(function(){e.$embedLoading.hide()}))}},{key:"onUploadClick",value:function(){this.uploadInitialized||(this.uploadInit(),this.uploadInitialized=!0);try{this.$uploadFile[0].value=null}catch(t){}this.$uploadFile.click()}},{key:"uploadInit",value:function(){var i=this;this.$uploadFile||(this.$uploadFile=this.$upload.find(".ps-js-file"),this.$uploadFile.psFileupload({replaceFileInput:!1,add:function(t){var t=t.target,o=i.$uploadProgress.find(".ps-js-percent-bar"),n=i.$uploadProgress.find(".ps-js-percent");i.showUpload(),n.html(""),o.css({transition:"",width:1}),i.beforeUnloadHandler||(i.beforeUnloadHandler=function(){return!0},a.observer.addFilter("beforeunload",i.beforeUnloadHandler)),i.audio=new u.default(t),i.audio.on("progress",r.default.throttle(function(t){var e=+t,t=Math.min(100,+t);0<e&&e<100&&(e=e.toFixed(2)),n.html("".concat(e,"%")),o.css({transition:"width 1s",width:"".concat(t,"%")}),100===t&&setTimeout(function(){i.$uploadProgress.hide()},1500)},a.browser.isIOS()?1500:250)),i.audio.getHTML().then(function(){i.$uploadDone.show(),i.audio.getData().then(function(t){i.beforeUnloadHandler&&(a.observer.removeFilter("beforeunload",i.beforeUnloadHandler),i.beforeUnloadHandler=null),i.data=t,i.$postbox.on_focus(),i.$postbox.on_change()})}).catch(function(t,e){var o=i.$uploadFailed,n=o.find(".ps-js-failed-message");e=t.errors&&t.errors.join(" ")||"Error.",n.html(e),o.show()})}}))}}])&&d(t.prototype,o),n&&d(t,n),e}();c.default=e}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./audio":6}],11:[function(n,t,c){(function(o){(function(){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var i=t("undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null),r=t("undefined"!=typeof window?window._:void 0!==o?o._:null),a=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==s(t)&&"function"!=typeof t)return{default:t};var e=l();if(e&&e.has(t))return e.get(t);var o,n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in t){var r;Object.prototype.hasOwnProperty.call(t,o)&&((r=i?Object.getOwnPropertyDescriptor(t,o):null)&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=t[o])}n.default=t,e&&e.set(t,n);return n}("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null),u=t(n("./video"));function l(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return l=function(){return t},t}function t(t){return t&&t.__esModule?t:{default:t}}function d(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var e=function(){function e(t){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=window.peepsovideosdata||{},this.$postbox=t,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxVideo=this.$postbox.find(".ps-postbox-tabs [data-tab-id=videos]"),this.$postboxVideoShortcut=this.$postbox.find("#video-post"),this.$postboxTab.on("peepso_posttabs_show-videos",function(){o.show()}),this.$postboxTab.on("peepso_posttabs_cancel-videos",function(){o.cancel()}),this.$postboxTab.on("peepso_posttabs_submit-videos",function(){o.post()}),this.$postboxVideoShortcut.on("click",function(){o.$postboxTab.find("[data-tab=videos]").click()}),a.observer.addAction("postbox_type_set",i.default.proxy(function(t,e){t===this.$postbox&&"videos"===e&&this.$postboxVideoShortcut.trigger("click")},this),10,2),this.$embed=this.$postbox.find(".ps-js-video-embed"),this.$embedUrl=this.$embed.find(".ps-js-url"),this.$embedLoading=this.$embed.find(".ps-js-loading"),this.$embedUrl.on("input",r.default.debounce(function(t){return o.embed(t.target.value)},2e3)),this.$embedUrl.on("paste",function(t){return r.default.defer(function(){return o.embed(t.target.value)})}),this.$embedUrl.on("blur",function(t){o.$uploadBtn.off("click"),r.default.defer(function(){return o.$uploadBtn.on("click",function(){return o.onUploadClick()})}),o.embed(t.target.value)}),this.$upload=this.$postbox.find(".ps-js-video-upload"),this.$uploadBtn=this.$upload.find(".ps-js-btn"),this.$uploadForm=this.$upload.find(".ps-js-form"),this.$uploadTitle=this.$upload.find(".ps-js-title"),this.$uploadProgress=this.$upload.find(".ps-js-progress"),this.$uploadDone=this.$upload.find(".ps-js-done"),this.$uploadFailed=this.$upload.find(".ps-js-failed"),this.$uploadSuccess=this.$upload.find(".ps-js-success"),this.$uploadBtn.on("click",function(){return o.onUploadClick()}),this.$separator=this.$postbox.find(".ps-js-video-separator"),this.$preview=this.$postbox.find(".ps-js-video-preview"),this.mode=null,this.data=null,this.$uploadTitle.on("input",r.default.throttle(function(){o.$postbox.on_change()},500)),a.observer.addFilter("peepso_postbox_can_submit",function(t,e){return o.$postbox===e&&"videos"===o.$postboxTab.current_tab_id&&("embed"===o.mode?t.hard.push(!!o.data):"upload"===o.mode&&(e=o.$uploadTitle.val().trim(),t.hard.push(!(!o.data||!e)))),t},10,2),a.observer.addFilter("peepso_postbox_onsave",function(t,e){return o.$postbox===e&&"videos"===o.$postboxTab.current_tab_id&&("upload"!==o.mode||o.data&&o.data.is_audio||(o.uploadShowNotice=!0)),t},10,2),this.$postbox.on("postbox.post_saved",function(){var t;o.uploadShowNotice&&(delete o.uploadShowNotice,(t=o.$uploadSuccess.clone()).show().insertAfter(o.$postbox),t.delay(3e3).fadeOut("slow",function(){t.remove()}))}),this.uploadInit(),this.uploadInitialized=!0}var t,o,n;return t=e,(o=[{key:"show",value:function(){this.mode=null,this.$postboxVideoShortcut.addClass("active"),this.$postboxVideo.show(),this.$embed.show(),this.$separator.show(),this.$upload.show(),this.$uploadBtn.show(),this.$uploadForm.hide(),this.$uploadSuccess.hide(),this.$preview.hide(),+this.config.upload_enable?this.$postboxStatus.hide():(this.$postboxStatus.show(),this.mode="embed")}},{key:"showEmbed",value:function(){this.mode="embed",this.$postboxStatus.show(),this.$embed.show(),this.$separator.hide(),this.$upload.hide(),this.$preview.show()}},{key:"showUpload",value:function(){this.mode="upload",this.$postboxStatus.show(),this.$embed.hide(),this.$separator.hide(),this.$upload.show(),this.$uploadTitle.val(""),this.$uploadBtn.hide(),this.$uploadForm.show(),this.$uploadProgress.show(),this.$uploadDone.hide(),this.$uploadFailed.hide(),this.$preview.show()}},{key:"cancel",value:function(){this.mode=null,this.data=null,this.$postboxVideoShortcut.removeClass("active"),this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.$postbox.on_change()}},{key:"post",value:function(){var t="postbox_req_"+this.$postbox.guid;a.observer.addFilter(t,this.postSetRequest,10,1,this),this.$postbox.save_post(),a.observer.removeFilter(t,this.postSetRequest,10)}},{key:"postSetRequest",value:function(t){return"embed"===this.mode?r.default.extend(t,{type:"video",url:this.data.url}):"upload"===this.mode&&r.default.extend(t,{type:"video",video:this.data.file,video_title:this.$uploadTitle.val().trim()}),t}},{key:"embed",value:function(t){var e=this,t=0<arguments.length&&void 0!==t?t:"";(t=t.trim()).match(/^https?:\/\//i)&&t!==this._embedUrl&&(this._embedUrl=t,this.video&&this.video.fetchAbort(),this.showEmbed(),this.$embedLoading.show(),this.video=new u.default(t),this.video.getHTML().then(function(t){e.$preview.html(t),e.video.getData().then(function(t){e.data=t,e.$postbox.on_change()})}).catch(function(t){e.$embedUrl.val(e._embedUrl=""),(0,a.dialog)(t,{error:!0}).show()}).finally(function(){e.$embedLoading.hide()}))}},{key:"onUploadClick",value:function(){this.uploadInitialized||(this.uploadInit(),this.uploadInitialized=!0);try{this.$uploadFile[0].value=null}catch(t){}this.$uploadFile.click()}},{key:"uploadInit",value:function(){var i=this;this.$uploadFile||(this.$uploadFile=this.$upload.find(".ps-js-file"),this.$uploadFile.psFileupload({replaceFileInput:!1,add:function(t){var t=t.target,o=i.$uploadProgress.find(".ps-js-percent-bar"),n=i.$uploadProgress.find(".ps-js-percent");i.showUpload(),n.html(""),o.css({transition:"",width:1}),i.beforeUnloadHandler||(i.beforeUnloadHandler=function(){return!0},a.observer.addFilter("beforeunload",i.beforeUnloadHandler)),i.video=new u.default(t),i.video.on("progress",r.default.throttle(function(t){var e=+t,t=Math.min(100,+t);0<e&&e<100&&(e=e.toFixed(2)),n.html("".concat(e,"%")),o.css({transition:"width 1s",width:"".concat(t,"%")}),100===t&&setTimeout(function(){i.$uploadProgress.hide()},1500)},a.browser.isIOS()?1500:250)),i.video.getHTML().then(function(){i.$uploadDone.show(),i.video.getData().then(function(t){i.beforeUnloadHandler&&(a.observer.removeFilter("beforeunload",i.beforeUnloadHandler),i.beforeUnloadHandler=null),i.data=t,i.$postbox.on_focus(),i.$postbox.on_change()})}).catch(function(t,e){var o=i.$uploadFailed,n=o.find(".ps-js-failed-message");e=t.errors&&t.errors.join(" ")||"Error.",n.html(e),o.show()})}}))}}])&&d(t.prototype,o),n&&d(t,n),e}();c.default=e}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./video":17}],12:[function(n,t,f){(function(o){(function(){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.default=void 0;var r=t("undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null),s=t(n("eventemitter3"));function t(t){return t&&t.__esModule?t:{default:t}}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(o){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=d(o);return t=n?(t=d(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==i(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=peepsovideosdata.upload_url,p=peepsovideosdata.nonce,e=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(i,s.default);var t,e,o,n=l(i);function i(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=t.files[0];return(t=n.call(this)).data=new FormData,t.data.append("filedata",e),t.data.append("size",e.size),t.data.append("name",e.name),t.data.append("_wpnonce",p),t}return t=i,(e=[{key:"upload",value:function(){var n=this;return new Promise(function(e,o){r.default.ajax({url:c,data:n.data,processData:!1,contentType:!1,dataType:"json",type:"POST",xhr:function(){var t=null;return t=window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):new window.XMLHttpRequest,t.upload.addEventListener("progress",function(t){t.lengthComputable&&(t=+(100*t.loaded/t.total).toFixed(2),n.emit("progress",t))},!1),t}}).done(function(t){t.success?e(t.data):o(t)}).fail(function(t,e){o(e)})})}}])&&a(t.prototype,e),o&&a(t,o),i}();f.default=e}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{eventemitter3:19}],13:[function(t,e,o){arguments[4][2][0].apply(o,arguments)},{dup:2,eventemitter3:19}],14:[function(n,t,c){(function(o){(function(){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var r=t("undefined"!=typeof window?window.peepso:void 0!==o?o.peepso:null),s=t(n("./abstract"));function t(t){return t&&t.__esModule?t:{default:t}}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(o){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=d(o);return t=n?(t=d(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==i(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var e=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(i,s.default);var t,e,o,n=l(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n.apply(this,arguments)}return t=i,(e=[{key:"fetch",value:function(){var n=this;return new Promise(function(e,o){n.data?e(n.data):n.xhr=r.default.postJson("videosajax.get_preview",{url:n.source},function(t){t.success?(n.data=t.data,e(n.data)):o(t&&t.errors&&t.errors[0])}).ret})}},{key:"fetchAbort",value:function(){this.xhr&&(this.xhr.abort(),this.xhr=void 0)}}])&&a(t.prototype,e),o&&a(t,o),i}();c.default=e}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./abstract":13}],15:[function(t,e,o){arguments[4][4][0].apply(o,arguments)},{"./embed":14,dup:4}],16:[function(t,e,o){arguments[4][5][0].apply(o,arguments)},{"../uploader":12,"./abstract":13,dup:5}],17:[function(t,e,o){arguments[4][6][0].apply(o,arguments)},{"./embed":14,"./facebook":15,"./file":16,dup:6,eventemitter3:19}],18:[function(o,t,e){(function(e){(function(){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i,a=t("undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null),u=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==s(t)&&"function"!=typeof t)return{default:t};var e=l();if(e&&e.has(t))return e.get(t);var o,n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in t){var r;Object.prototype.hasOwnProperty.call(t,o)&&((r=i?Object.getOwnPropertyDescriptor(t,o):null)&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=t[o])}n.default=t,e&&e.set(t,n);return n}("undefined"!=typeof window?window.peepso:void 0!==e?e.peepso:null),r=t(o("./uploader"));function l(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return l=function(){return t},t}function t(t){return t&&t.__esModule?t:{default:t}}window.ps_videos=u.default.videos=function(){window.PsVideos=function t(){this._fileList=[];this.show_progress=null;this.queue_filesize=0;this.$url_textarea=null;this.$uploader=null;this.has_valid_url=false;this.preview_request=false;this.save_post=null;this.last_error=null};var t=new PsVideos;return PsVideos.prototype.init=function(){var n=this;u.observer.addFilter("peepso_postbox_can_submit",function(t){return"videos"===n.$postbox.$posttabs.current_tab_id&&t.hard.push(i||!!n.has_valid_url),t},30,1);var t=this.$postbox.$textarea.attr("placeholder");jQuery(this.$postbox.$posttabs).on("peepso_posttabs_show-videos",function(t,e,o){jQuery("#video-post",n.$postbox).hide(),e.show(),void 0!==postbox.$textarea&&postbox.$textarea.attr("placeholder","Say something about this video..."),jQuery(".ps-postbox-status",o.options.container).show()}),this.$url_textarea=jQuery(".ps-videos-url",this.$postbox),this.$uploader=jQuery("[data-tab-id=videos]").find("#ps-upload-container > div").eq(0),this.$postbox.$posttabs.on("peepso_posttabs_submit-videos",function(){i||n.has_valid_url?(u.observer.addFilter("postbox_req_"+n.$postbox.guid,function(t){return n.set_post_filter(t)},10,1),n.$postbox.save_post(),u.observer.removeFilter("postbox_req_"+n.$postbox.guid,function(t){return n.set_post_filter(t)},10,1)):null!==n.last_error&&alert(n.last_error)}),this.$postbox.$posttabs.on("peepso_posttabs_cancel-videos",function(){jQuery("#video-post",n.$postbox).show(),n.$postbox.$textarea.attr("placeholder",t),n.on_cancel()}),jQuery("#video-post",this.$postbox).on("click",function(){"videos"!==n.$postbox.$posttabs.current_tab().data("tab")&&(jQuery(n.$postbox.$posttabs).find("[data-tab='videos']").trigger("click"),n.$postbox.$textarea.focus())}),this.$url_textarea.on("change",function(){n.on_url_input(n.$url_textarea.val())}),this.$uploader.on("click",function(){n.browseFile()}),u.observer.addFilter("postbox_req_edit",function(t,e){var o=jQuery(".ps-videos-edit-url",this.$postbox);return 0<o.length&&(t.url=o.val(),t.type="video"),t},10,2),this.save_post=jQuery.proxy(activity.option_savepost,activity),activity.option_savepost=function(t){n.option_savepost(t)}},PsVideos.prototype.on_url_input=function(t){var i=this.$postbox.find(".ps-postbox-videos .ps-postbox-input .ps-postbox-loading"),r=this.$postbox.find(".ps-postbox-videos .ps-postbox-preview"),s=this.$postbox.find(".ps-postbox-action > .ps-button-action.postbox-submit");this.preview_request&&this.preview_request.ret&&this.preview_request.ret.abort(),i.show(),this.preview_request=u.default.postJson("videosajax.get_preview",{url:t},a.default.proxy(function(t){var e,o,n=/<div[^<]+fb-root[^<]+<[^>]+>/i;i.hide(),t.success?(this.has_valid_url=!0,(o=(e=t.data.html).match(n))&&(e=(e=e.replace(n,"")).replace(/<script[^<]+<\/script>/i,"")),r.empty().show().html(e),o&&u.default.util.fbParseXFBML()):(this.has_valid_url=!1,r.hide().empty(),s.hide(),t.errors&&(this.last_error=t.errors[0],alert(this.last_error))),this.$postbox.on_change(),this.preview_request=!1},this))},PsVideos.prototype.set_postbox=function(t){this.$postbox=t},PsVideos.prototype.on_cancel=function(){this.preview_request&&(this.preview_request.ret.abort(),jQuery(".ps-postbox-videos .ps-postbox-input .ps-postbox-loading",this.$postbox).hide()),this.has_valid_url=!1,jQuery("#ps-videos-input",this.$postbox).hide(),this.$url_textarea.val(""),i=!1,jQuery(".ps-postbox-videos .ps-postbox-preview",this.$postbox).hide().html(""),this.$postbox.on_change()},PsVideos.prototype.set_post_filter=function(t){return i?t.video_id=i:t.url=this.$url_textarea.val(),t.type="video",console.log(t),t},PsVideos.prototype.play_video=function(t,e){if("vimeo"===(e=e||{}).type)return this.play_vimeo_video(t,e),!1;$player=jQuery("#peepso-video-player-"+jQuery(t).data("post-id")).find("iframe"),jQuery("#peepso-video-player-"+jQuery(t).data("post-id")).fadeIn();e=jQuery(t).parents(".video-avatar");e.siblings(".video-description").css("display","block");var o,t=jQuery("#peepso-video-player-"+jQuery(t).data("post-id")).parent();t.show(),e.parent().prepend(t),e.fadeOut().remove();e=$player.width();return $player.width()/$player.height()<$player.parent().width()/$player.parent().height()?(o={width:"100%"},$player.css(o),new_width=$player.width(),$player.css("height",$player.height()*(new_width/e))):o={width:"100%",height:"390"},$player.css(o),!1},PsVideos.prototype.play_vimeo_video=function(t,e){var o=(t=(0,a.default)(t)).closest(".ps-media-video");!o.length||(o=o.prev(".cstream-attachment")).length&&(o.find("iframe").length||(0,a.default)('<iframe src="https://player.vimeo.com/video/'+e.id+'?autoplay=1" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="width:100%"></iframe>').appendTo(o),(t=t.closest(".video-avatar")).siblings(".video-description").css("display","block"),t.remove(),o.show())},PsVideos.prototype.option_savepost=function(e){var t,o=this,n=jQuery(".ps-js-activity--"+e);0<n.length&&void 0!==(t=u.observer.applyFilters("postbox_req_edit",{},jQuery(".cstream-edit textarea",n))).type&&void 0!==t.url&&"video"===t.type?(jQuery(".cstream-edit textarea, .cstream-edit input",n).attr("disabled","disabled"),jQuery(".ps-edit-loading",n).show(),jQuery(".cstream-edit button",n).hide(),u.default.postJson("videosajax.get_preview",{url:t.url},function(t){void 0!==t.errors?(alert(t.errors[0]),jQuery(".cstream-edit textarea, .cstream-edit input",n).removeAttr("disabled"),jQuery(".ps-edit-loading",n).hide(),jQuery(".cstream-edit button",n).show()):o.save_post(e)})):this.save_post(e)},PsVideos.prototype.browseFile=function(){var t,n=this;this.$file||(this.$file=(0,a.default)('<input type="file" name="filedata[]" accept="video/mp4,video/x-m4v,video/*" />'),(t=(0,a.default)("<div />").append(this.$file)).css({position:"absolute",top:0,right:0,width:1,height:1,overflow:"hidden"}),t.insertAfter(this.$uploader),this.$file.on("change",function(t){var e=t.target,o=e.files[0];t.preventDefault(),n.validate(o).then(function(){new r.default(e).upload().then(function(t){i=t.id})}).fail(function(t){alert(t[0])})})),this.$file.click()},PsVideos.prototype.validate=function(o){return a.default.Deferred(function(e){var t={type:o.type,size:parseInt(o.size)};u.default.postJson("videosajax.validate_video_upload",t,function(t){t&&t.success?e.resolve():e.reject(t&&t.errors)})})},t}(),u.observer.addAction("postbox_init",function(t){t.$tabContext.find("#audio-post").remove(),t.$tabContext.find("#video-post").remove()},10,1),u.observer.addAction("peepso_delete_post",function(t){(0,a.default)(".ps-widget--videos").find(".ps-js-video").filter('[data-post-id="'+t+'"]').remove()},10,1)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./uploader":12}],19:[function(t,e,o){"use strict";var n=Object.prototype.hasOwnProperty,f="~";function i(){}function r(t,e,o){this.fn=t,this.context=e,this.once=o||!1}function s(t,e,o,n,i){if("function"!=typeof o)throw new TypeError("The listener must be a function");i=new r(o,n||t,i),e=f?f+e:e;return t._events[e]?t._events[e].fn?t._events[e]=[t._events[e],i]:t._events[e].push(i):(t._events[e]=i,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(f=!1)),a.prototype.eventNames=function(){var t,e,o=[];if(0===this._eventsCount)return o;for(e in t=this._events)n.call(t,e)&&o.push(f?e.slice(1):e);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var t=f?f+t:t,e=this._events[t];if(!e)return[];if(e.fn)return[e.fn];for(var o=0,n=e.length,i=new Array(n);o<n;o++)i[o]=e[o].fn;return i},a.prototype.listenerCount=function(t){t=f?f+t:t,t=this._events[t];return t?t.fn?1:t.length:0},a.prototype.emit=function(t,e,o,n,i,r){var s=f?f+t:t;if(!this._events[s])return!1;var a,u=this._events[s],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,o),!0;case 4:return u.fn.call(u.context,e,o,n),!0;case 5:return u.fn.call(u.context,e,o,n,i),!0;case 6:return u.fn.call(u.context,e,o,n,i,r),!0}for(p=1,a=new Array(l-1);p<l;p++)a[p-1]=arguments[p];u.fn.apply(u.context,a)}else for(var d,c=u.length,p=0;p<c;p++)switch(u[p].once&&this.removeListener(t,u[p].fn,void 0,!0),l){case 1:u[p].fn.call(u[p].context);break;case 2:u[p].fn.call(u[p].context,e);break;case 3:u[p].fn.call(u[p].context,e,o);break;case 4:u[p].fn.call(u[p].context,e,o,n);break;default:if(!a)for(d=1,a=new Array(l-1);d<l;d++)a[d-1]=arguments[d];u[p].fn.apply(u[p].context,a)}return!0},a.prototype.on=function(t,e,o){return s(this,t,e,o,!1)},a.prototype.once=function(t,e,o){return s(this,t,e,o,!0)},a.prototype.removeListener=function(t,e,o,n){t=f?f+t:t;if(!this._events[t])return this;if(!e)return u(this,t),this;var i=this._events[t];if(i.fn)i.fn!==e||n&&!i.once||o&&i.context!==o||u(this,t);else{for(var r=0,s=[],a=i.length;r<a;r++)(i[r].fn!==e||n&&!i[r].once||o&&i[r].context!==o)&&s.push(i[r]);s.length?this._events[t]=1===s.length?s[0]:s:u(this,t)}return this},a.prototype.removeAllListeners=function(t){return t?(t=f?f+t:t,this._events[t]&&u(this,t)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=f,a.EventEmitter=a,void 0!==e&&(e.exports=a)},{}]},{},[8]);