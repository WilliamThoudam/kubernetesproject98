!function o(r,p,a){function h(e,t){if(!p[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}var n=p[e]={exports:{}};r[e][0].call(n.exports,function(t){return h(r[e][1][t]||t)},n,n.exports,o,r,p,a)}return p[e].exports}for(var c="function"==typeof require&&require,t=0;t<a.length;t++)h(a[t]);return h}({1:[function(t,e,i){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n,o,h,r,p,a;n=window,o=p="PsGiphyComment",h=n.jQuery,r=t("./giphy.js"),a=peepso.createClass(o,{__constructor:function(){this.template=peepsogiphydata.dialogGiphyTemplate,peepso.observer.addFilter("comment_show_button",this.shouldShowButton,10,1),peepso.observer.addFilter("comment_can_submit",this.isSubmittable,10,1),peepso.observer.addFilter("comment_req",this.filterRequest,10,2),peepso.observer.addAction("comment_edit",this.onEdit,10,2),h(h.proxy(this.onDocumentLoaded,this))},onDocumentLoaded:function(){h(document).on("click",".ps-js-comment-giphy",h.proxy(this.onAttach,this)),h(document).on("click",".ps-js-addon-giphy .ps-js-remove",h.proxy(this.onRemove,this)),h(document).on("ps_comment_aftersave",h.proxy(this.onSaved,this))},onAttach:_.throttle(function(t){var e,i,s=this,n="ps-giphy-initialized",o="ps-giphy-loading",r=peepso.rtl,p=h(t.currentTarget);t.preventDefault(),t.stopPropagation(),e=p.closest(".ps-js-comment-new, .ps-js-comment-edit"),(i=e.prev(".ps-js-giphy-container")).length||((i=h(this.template)).data("act-id",e.data("id")),i.find(".ps-js-giphy-list").css("transition","margin-".concat(r?"right":"left"," .5s")),i.hide().insertBefore(e),i.on("input",".ps-js-giphy-query",h.proxy(this.onSearch,this)),i.on("click",".ps-js-giphy-list img",h.proxy(this.onSelectImage,this)),i.on("click",".ps-js-giphy-nav-left",function(t){return s.onScroll(t,"left")}),i.on("click",".ps-js-giphy-nav-right",function(t){return s.onScroll(t,"right")})),i.is(":visible")?i.hide():(i.show(),i.data(n)||i.data(o)||(i.data(o,!0),this.search(i).done(h.proxy(function(){i.find(".ps-js-giphy-query").show(),i.data(n,!0),i.removeData(o)},this))))},1e3),search:function(n,o){return h.Deferred(h.proxy(function(e){var t=r.getInstance(),i=n.find(".ps-js-giphy-loading").show(),s=n.find(".ps-js-giphy-list").hide();t.search(o).done(h.proxy(function(t){this.render(n,t),i.hide(),s.show(),e.resolveWith(this)},this))},this))},render:function(t,e){var i=t.find(".ps-js-giphy-list"),s=t.find(".ps-js-giphy-list-item"),n=peepso.template(s.html()),o=peepsogiphydata.giphy_rendition_comments||"fixed_width",r=_.map(e,function(t,e){return t.images[o]&&h.extend(t,{src:t.images[o].url,preview:t.images.preview_gif.url}),n(t)});i.html(r.join(""))},onSearch:function(t){var e=h(t.currentTarget),i=e.closest(".ps-js-giphy-container"),s=i.find(".ps-js-giphy-list"),n=i.find(".ps-js-giphy-loading"),o=peepso.rtl;s.hide().css(o?"marginRight":"marginLeft",0),n.show(),this._onSearch(i,e)},_onSearch:_.debounce(function(t,e){this.search(t,h.trim(e.val()))},1e3),onSelectImage:function(t){var e=h(t.currentTarget),i=e.closest(".ps-js-giphy-container"),s=e.attr("src"),n=e.attr("data-url");this.select(i,s,n),i.hide()},onScroll:function(t,e){var i,s,n=peepso.rtl,o=h(t.currentTarget).closest(".ps-js-slider"),r=o.find(".ps-js-giphy-list"),p=o.width(),a=parseInt(r.css(n?"marginRight":"marginLeft"))||0;e===(n?"right":"left")?a=Math.min(a+p,0):e===(n?"left":"right")&&(i=r.children(".ps-js-giphy-item").last(),s=n?Math.abs(i.position().left):i.position().left+i.width()-p,a-=Math.min(p,s)),r.css(n?"marginRight":"marginLeft",a)},select:function(t,e,i){var s=t.siblings(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addons").find(".ps-js-addon-giphy");s.find(".ps-js-remove").show(),s.find(".ps-js-img").attr("src",e).attr("data-url",i).show(),s.show(),h(document).trigger("ps_comment_addon_added",s)},onRemove:function(t){var e=h(t.currentTarget).closest(".ps-js-addon-giphy");e.find(".ps-js-remove").hide(),e.find(".ps-js-img").attr("src","").attr("data-url","").hide(),e.hide(),h(document).trigger("ps_comment_addon_removed",e)},shouldShowButton:function(t){var e,i=h(t.el).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-giphy");return i.is(":visible")&&(e=i.find(".ps-js-img")).length&&e.attr("src")&&(t.show=!0),t},isSubmittable:function(t){var e,i=h(t.el).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-giphy");return i.is(":visible")&&(e=i.find(".ps-js-img")).length&&e.attr("src")&&(t.can_submit=!0),t},filterRequest:function(t,e){var i,s=h(e).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-giphy");return s.is(":visible")&&(i=s.find(".ps-js-img")).length&&i.attr("data-url")&&(t.giphy=i.attr("data-url"),t.giphy=t.giphy.replace(/^[a-z]+:\/\//i,"")),t},onSaved:function(t,e,i){var s=h(i).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-giphy");s.find(".ps-js-remove").hide(),s.find(".ps-js-img").attr("src","").hide(),s.hide(),h(document).trigger("ps_comment_addon_removed",s)},onEdit:function(t,e){var i=h(e).find(".ps-js-addon-giphy"),s=i.find(".ps-js-img");s.length&&s.attr("src")?(i.find(".ps-js-remove").show(),i.find(".ps-js-img").show(),i.show(),h(document).trigger("ps_comment_addon_added",i)):(i.find(".ps-js-remove").hide(),i.find(".ps-js-img").hide(),i.hide(),h(document).trigger("ps_comment_addon_removed",i))}}),"object"===(void 0===e?"undefined":s(e))&&e.exports?e.exports=a:n[p]=a,new a},{"./giphy.js":2}],2:[function(t,e,i){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n,o,r,p,a,h;n=window,o=p="PsGiphy",r=n.jQuery,a=peepso.createClass(o,{__constructor:function(){this.apiKey=peepsogiphydata.giphy_api_key,this.displayLimit=peepsogiphydata.giphy_display_limit,this.rating=peepsogiphydata.giphy_rating},search:function(i){return i=r.trim(i||""),r.Deferred(r.proxy(function(e){this._result||(this._result={});var t=this._result[i];t?e.resolveWith(this,[t]):this._giphy(i).done(r.proxy(function(t){this._result[i]=t.data,e.resolveWith(this,[t.data])},this))},this))},_giphy:function(t){var e="https://api.giphy.com/v1/gifs/trending",i={api_key:this.apiKey,limit:this.displayLimit};return this.rating&&(i.rating=this.rating),t&&(e="https://api.giphy.com/v1/gifs/search",i=_.extend(i,{q:t,offset:0})),r.get(e,i)}}),h={getInstance:function(){return this._instance||(this._instance=new a),this._instance}},"object"===(void 0===e?"undefined":s(e))&&e.exports?e.exports=h:n[p]=h},{}],3:[function(s,t,e){(function(t){"use strict";var e,n=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},i="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null;s("./comment"),s("./message"),s("./postbox"),i.observer.addFilter("human_friendly_extras",function(t,e,i){var s;return e||!i||i.querySelector(".ps-js-post-header")||(s=(0,n.default)(i).find(".ps-comment-media .ps-js-giphy [data-preview]")).length&&t.push(s.data("preview")),t},20,3)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./comment":1,"./message":4,"./postbox":5}],4:[function(t,e,i){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n,o,h,r,p,a;n=window,o=p="PsGiphyMessage",h=n.jQuery,r=t("./giphy.js"),a=peepso.createClass(o,{__constructor:function(){h(h.proxy(this.onDocumentLoaded,this))},onDocumentLoaded:function(){h(document).on("click",".ps-js-chat-window .ps-js-giphy-trigger",h.proxy(this.onToggle,this))},onToggle:function(t){var e=this,i=h(t.currentTarget).siblings(".ps-js-giphy-container"),s="ps-giphy-initialized",n="ps-giphy-loading";t.preventDefault(),t.stopPropagation(),i.is(":visible")?i.hide():(i.show(),i.data(s)||i.data(n)||(i.data(n,!0),i.on("input",".ps-js-giphy-query",h.proxy(this.onSearch,this)),i.on("click",".ps-js-giphy-list img",h.proxy(this.onSelectImage,this)),i.on("click",".ps-js-giphy-nav-left",function(t){return e.onScroll(t,"left")}),i.on("click",".ps-js-giphy-nav-right",function(t){return e.onScroll(t,"right")}),this.search(i).done(h.proxy(function(){i.find(".ps-js-giphy-query").show(),i.data(s,!0),i.removeData(n)},this))))},search:function(n,o){return h.Deferred(h.proxy(function(e){var t=r.getInstance(),i=n.find(".ps-js-giphy-loading").show(),s=n.find(".ps-js-giphy-list").hide();t.search(o).done(h.proxy(function(t){this.render(n,t),i.hide(),s.show(),e.resolveWith(this)},this))},this))},render:function(t,e){var i=t.find(".ps-js-giphy-list"),s=t.find(".ps-js-giphy-list-item"),n=peepso.template(s.html()),o=peepsogiphydata.giphy_rendition_messages||"fixed_width",r=_.map(e,function(t,e){return t.images[o]&&h.extend(t,{src:t.images[o].url,preview:t.images.preview_gif.url}),n(t)});i.html(r.join(""))},onSearch:function(t){var e=h(t.currentTarget),i=e.closest(".ps-js-giphy-container"),s=i.find(".ps-js-giphy-list"),n=i.find(".ps-js-giphy-loading");s.hide().css({marginLeft:"",marginRight:""}),n.show(),this._onSearch(i,e)},_onSearch:_.debounce(function(t,e){this.search(t,h.trim(e.val()))},1e3),onSelectImage:function(t){var e=h(t.currentTarget),i=e.closest(".ps-js-giphy-container"),s=i.closest(".ps-js-chat-window").data("id"),n=e.attr("data-url");i.hide(),this.post(s,n)},onScroll:function(t,e){var i,s,n=peepso.rtl,o=h(t.currentTarget).closest(".ps-js-slider"),r=o.find(".ps-js-giphy-list"),p=o.width(),a=parseInt(r.css(n?"marginRight":"marginLeft"))||0;e===(n?"right":"left")?a=Math.min(a+p,0):e===(n?"left":"right")&&(i=r.children(".ps-js-giphy-item").last(),s=n?Math.abs(i.position().left):i.position().left+i.width()-p,a-=Math.min(p,s)),r.css(n?"marginRight":"marginLeft",a)},post:function(t,e){peepso.observer.doAction("msgso_send_message",t,"",{type:"giphy",giphy:e})}}),"object"===(void 0===e?"undefined":s(e))&&e.exports?e.exports=a:n[p]=a,new a},{"./giphy.js":2}],5:[function(s,t,e){(function(t){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),o=e("undefined"!=typeof window?window._:void 0!==t?t._:null),a=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=h();if(e&&e.has(t))return e.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t){var o;Object.prototype.hasOwnProperty.call(t,n)&&((o=s?Object.getOwnPropertyDescriptor(t,n):null)&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n])}i.default=t,e&&e.set(t,i);return i}("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),p=e(s("./giphy"));function h(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return h=function(){return t},t}function e(t){return t&&t.__esModule?t:{default:t}}function c(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var i=function(){function i(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.$postbox=t,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxGiphy=this.$postbox.find(".ps-postbox-tabs [data-tab-id=giphy]"),this.$preview=this.$postboxGiphy.find(".ps-js-giphy-preview").hide(),this.$selector=this.$postboxGiphy.find(".ps-js-giphy-container").show(),this.$loading=this.$selector.find(".ps-js-giphy-loading"),this.$query=this.$selector.find(".ps-js-giphy-query"),this.$result=this.$selector.find(".ps-js-giphy-list"),this.$slider=this.$result.parent(),this.onScroll=o.default.throttle(this.onScroll,500),this.$preview.on("click",".ps-js-giphy-change",function(t){return e.onChangeImage(t)}),this.$query.on("input",function(t){return e.onInput(t)}),this.$result.on("click","img",function(t){return e.onSelect(t.target)}),this.$slider.find(".ps-js-giphy-nav-left").on("click",function(){return e.onScroll("left")}),this.$slider.find(".ps-js-giphy-nav-right").on("click",function(){return e.onScroll("right")}),this.giphy=null,this.itemTemplate=a.default.template(this.$slider.find(".ps-js-giphy-list-item").html()),this.$postboxTab.on("peepso_posttabs_show-giphy",n.default.proxy(this.show,this)),this.$postboxTab.on("peepso_posttabs_cancel-giphy",n.default.proxy(this.cancel,this)),this.$postboxTab.on("peepso_posttabs_submit-giphy",n.default.proxy(this.post,this)),a.observer.addAction("postbox_type_set",n.default.proxy(this.actionPostboxTypeSet,this),10,2),a.observer.addFilter("peepso_postbox_can_submit",n.default.proxy(this.filterCanSubmit,this),10,2)}var t,e,s;return t=i,(e=[{key:"show",value:function(){this.$postboxStatus.show(),this.$postboxGiphy.show(),this.giphy||(this.giphy=p.default.getInstance(),this.search())}},{key:"cancel",value:function(){this.selectedImage=null,this.$postboxGiphy.hide(),this.$preview.hide(),this.$selector.show(),this.$postbox.on_change()}},{key:"post",value:function(){var t="postbox_req_"+this.$postbox.guid;a.observer.addFilter(t,this.filterPostboxReq,10,1,this),this.$postbox.save_post(),a.observer.removeFilter(t,this.filterPostboxReq,10)}},{key:"value",value:function(){var t;return this.selectedImage&&(t=this.selectedImage),t}},{key:"search",value:function(t){var e=this,i=0<arguments.length&&void 0!==t?t:"";this.$result.hide(),this.$loading.show(),clearTimeout(this.searchDelay);var s=this.searchDelay=setTimeout(function(){e.giphy.search(i).done(function(t){e.searchDelay===s&&(e.render(t),e.$loading.hide(),e.$result.show(),e.$query.show())})},1e3)}},{key:"render",value:function(t){var e=this,i=peepsogiphydata.giphy_rendition_comments||"fixed_width",s=t.map(function(t){return t.images[i]&&(t.src=t.images[i].url,t.preview=t.images.preview_gif.url),e.itemTemplate(t)});this.$result.html(s.join(""))}},{key:"select",value:function(t,e){this.selectedImage=e,this.$selector.hide(),this.$preview.find("img").attr("src",t),this.$preview.show(),this.$postbox.on_change()}},{key:"scroll",value:function(t){var e,i,s=a.default.rtl,n=this.$selector.find(".ps-js-slider"),o=n.find(".ps-js-giphy-list"),r=n.width(),p=parseInt(o.css(s?"marginRight":"marginLeft"))||0;t===(s?"right":"left")?p=Math.min(p+r,0):t===(s?"left":"right")&&(e=o.children(".ps-js-giphy-item").last(),i=s?Math.abs(e.position().left):e.position().left+e.width()-r,p-=Math.min(r,i)),o.css(s?"marginRight":"marginLeft",p)}},{key:"onChangeImage",value:function(t){t.preventDefault(),t.stopPropagation(),this.selectedImage=null,this.$postbox.on_change(),this.$preview.hide(),this.$selector.show()}},{key:"onInput",value:function(t){var e=t.target.value;this.$result.hide(),this.$loading.show(),this.search(e.trim())}},{key:"onScroll",value:function(t){this.scroll(t)}},{key:"onSelect",value:function(t){this.select(t.src,t.getAttribute("data-url"))}},{key:"filterPostboxReq",value:function(t){var e=this.value();return e&&(t.type="giphy",t.giphy=e),t}},{key:"filterCanSubmit",value:function(t,e){return this.$postbox===e&&"giphy"===this.$postboxTab.current_tab_id&&t.hard.push(!!this.value()),t}},{key:"actionPostboxTypeSet",value:function(t,e){t===this.$postbox&&"giphy"===e&&"giphy"!==this.$postboxTab.current_tab_id&&this.$postbox.find("[data-tab=giphy]").trigger("click")}}])&&c(t.prototype,e),s&&c(t,s),i}();a.observer.addAction("peepso_postbox_addons",function(t){var e={init:function(){},set_postbox:function(t){t.find("[data-tab-id=giphy]").length&&new i(t)}};return t.push(e),t},10,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./giphy":2}]},{},[3]);